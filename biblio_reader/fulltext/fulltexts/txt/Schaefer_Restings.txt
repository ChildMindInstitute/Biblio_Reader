Resting-state fMRI and graph-based
methods for analyzing functional
connectivity
Alexander Schaefer
Lecture SS 2014
Max Planck Institute
for Human Cognitive and Brain Sciences Leipzig, Germany
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Introduction
• Resting State fMRI
• Graphs and their Definition
• Analyze and Compare Graphs

Brain Connectivity, Marie Liebert Publishing

Alexander Schäfer

Boettger, IEEE TVCG, 2014

Max Planck Institute for Human Cognitive and Brain Sciences

Resting State fMRI
• spontaneous brain activity in the absence of task
• correlated signal in functionally coupled networks

BB Biswal, MRM,1995
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Resting state fMRI
• rs-fMRI observation (Biswal95): correlated signal in functionally
coupled networks

Figures adopted from Van Dijk et al., 2010, Journal of Neurophysiology
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Resting State fMRI
• Intrinsic connectivity
– Present during task, in the absence of task and
under anesthesia
– Majority of the power of the signal is between is
in very slow signals (0.01 – 0.05 Hz)
– correlates with (neuronal) EEG signal (Mantini
2007)

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Resting State fMRI
• Correlated signal reflects functionally coupled
networks (www.youtube.com/user/YeoKrienen)

Yeo, J. Neurophysiol., 2011
Alexander Schäfer

Yeo, J. Neurophysiol., 2011
Max Planck Institute for Human Cognitive and Brain Sciences

Resting State fMRI
• Correlated signal reflects functionally coupled
networks

Yeo, J. Neurophysiol., 2011
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Resting State fMRI
• Resembles “task-based” coactivation areas
• Database of 10,000 studies (Smith, PNAS, 2010)

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Resting State fMRI
•
•
•
•

Good Test-Retest Reliability (Shezad, 2009)
Can be altered by training a task (Taubert 2010)
Can predict the age of a subject (Dosenbach 2010)
Can predict the disease status of a subject e.g. in
Depression (Zeng, 2012), ADHD (Fair, 2013)
Alzheimer (Sorg, 2007)

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Resting State fMRI
• intrinsic brain connectivity → the cross talk of brain
areas
• Whole brain cross talk → functional brain network

Biswal, MRM,1995

Alexander Schäfer

Brain Connectivity, Marie Liebert Publishing

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Defintion
• Some examples of graphs people already work with

Protein Interaction Graph
Tucker 2001
Alexander Schäfer

Airplane Graph
Aeorspace.org

Social Graph
Youarethem.co.uk
Max Planck Institute for Human Cognitive and Brain Sciences

Graph Defintion
• Some examples of graphs people already work with
• Advantage → we can use the same math for all of
them

Protein Interaction Graph
Tucker 2001
Alexander Schäfer

Airplane Graph
Aeorspace.org

Social Graph
Youarethem.co.uk
Max Planck Institute for Human Cognitive and Brain Sciences

Graph Defintion
• A Graph is a tupel (V,E)
• V is a set of vertices
• E is a set of edges, where e in E: V x V

Protein Interaction Graph
Tucker 2001
Alexander Schäfer

Airplane Graph
Aeorspace.org

Social Graph
Youarethem.co.uk
Max Planck Institute for Human Cognitive and Brain Sciences

Graph Defintion
• A Graph is a tupel (V,E)
• V is a set of vertices
• E is a set of edges, where e in E: V x V

Boettger, IEEE TVCG 2014
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Vertices
• “Good” definition of vertices is crucial for the
following graph analysis

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Vertices
• Voxel-based
– Each voxel represents a distinct node

Lohmann, PloS One, 2010
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Vertices
• Voxel-based
– Pro:
• Data Driven
• Good reliability
• High Resolution
– Con:
• Unclear Validity
• Computational intensive
• Higher risk of false positive short range
connections
Max Planck Institute for Human Cognitive and Brain Sciences
Alexander Schäfer

Set of Vertices
• Anatomical
– Base on prior anatomical information

Desikan, NeuroImage 2006
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Vertices
• Anatomical
– Pro:
• Intuitive parcellation
• Fast to compute
• High reliability
– Con:
• Low Resolution
• Variation in node size?
• Low validity?
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Vertices
• Random Parcellation
– Randomly into regions with similar size
– Allows multi resolutions:

Hagmann, PloS Bio, 2007
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Vertices
• Random
– Pro:
• Minimize node size variations
• Multi resoltuion
– Con:
• Unclear validity / reliability

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Vertices
• Functional Parcellation
– Based on prior functional information
– Coordinates from meta analysis or functional
homogeneity analysis

Dosenbach, Science, 2010
Alexander Schäfer

Smith, PNAS, 2009

Varoquax, Inf Proc Med, 2011

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Vertices
• functional
– Pro:
• Good reliability
• Good validity
– Con:
• May miss regions
• Difficult to apply to DTI

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Vertices
• “Good” definition of vertices is crucial for the
following graph analysis
• “Good”
– functional intra-homogeneous
– Ideally functional inter-heterogeneous
– reliable
– account for spatial relationships

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Defintion
• A Graph is a tupel (V,E)
• V is a set of vertices
• E is a set of edges, where e in E: V x V

Boettger, IEEE TVCG 2014
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Edges
• Estimate a “functional connection” between ROIs
• Data?
– Average signal over Parcell
– First eigenvector of PCA over ROI (lower
reliability; Zuo, 2010)

Chang, NeuroImage, 2008

• What do we do with the Data? There are many
differenty ideas.

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Edges
• What do we do with the Data? There are many
differenty ideas.
• Simplest idea (maybe best): measure the pairwise
similarity between regions

Zhao, NeuroImage, 2008
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Edges
• Pearson Correlation:

• Notice: → Correlation Matrix: normalized Covariance
Matrix
• Positive correlations indicate
a functional connection
• Matrix has dimension
Vertices x Vertices
• Matrix can describe the complete Graph Shen, J Neuro, 2012
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Edges
• Pearson Correlation:

• Notice: → Correlation Matrix: normalized Covariance
Matrix
• Performs quite well
• But induces indirect connections
• A→B→C
• False positive A – C
Shen, J Neuro, 2012
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Edges
• Solution → Partial Correlation:
– Regress out all other timeseries from the data
and then perform correlation
– Gets rid of indirect connections!
– Problem in (rs-) fMRI: low number of timepoints

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Edges
• Solution → Partial Correlation:
– Regress out all other timeseries from the data
and then perform correlation (or compute the
inverse Covariance Matrix)
– Gets rid of indirect connections!
– Problem in (rs-) fMRI: low number of timepoints
– Voxel-level: 60 000 voxels * 200 timepoints
– Rank of Correlation Matrix?

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Edges
• Solution → Sparse Inverse Covariance:
– Idea: regress less by eliminating some connections
from the regression process (sparse matrix)
– some connections are not essential to explain data
– Problem: Finding this sparse matrix is
computationally hard
– Solution: approximation algorithm (graphical lasso)

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Set of Edges
• Conclusion
– Pearson Correlation has problems with false
positives
– Partial Correlation performs better but has
problems with low d.o.f. in fMRI
– Sparse methods might help

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Defintion
• A Graph is a tupel (V,E)
• V is a set of vertices
• E is a set of edges, where e in E: V x V

Boettger, IEEE TVCG 2014
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Thresholding
• Validity: mix of correlations and anti-correlations
• Reliability: higher for stronger correlations
• Strategies:
– Sparsity Thresholding: use only the strongest x%
of edges
– Soft Thresholding: use only edges above value x
– Hard Thresholding: use only edges above value x
and set them to 1 (binarization)

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Analysis of Brain Organization
• Comparing Graphs / Brains
– Centrality Mapping
– Graph-topological metrics
– Predictive Modeling

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Investigate Brain Organization
• Unsupervised machine learning
• Power, Neuron, 2011
– info map algorithm (Rosvall,
Bergstrom, 2008)
– random walk
– optimal code to describe this
random walk
– code word -> subgraph
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Edge clustering
• Similarity between connections
• Hierarchical clustering

Figure adopted from Schaefer et al., 2014, Frontiers in Human Neuroscience
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Edge clustering
• http://openscience.cbs.mpg.de/schaefer/

Figure adopted from Schaefer et al., 2014, Frontiers in Human Neuroscience
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Comparing Graphs
• Centrality Analysis
– Degree Centrality
• Assign each Vertex the Sum over its weighted
edges:

Junker, BioInf, 2006
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Centrality Mapping
– Degree Centrality
• Assign each Vertex the Sum over its weighted
connections:

Zuo, Cerb. Cortex, 2010
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Centrality Mapping
– Eigenvector Centrality
• Assign each Vertex the load of its first
eigenvector:

• Cares also about indirect
connections
Zuo, Cerb. Cortex, 2010
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Centrality Mapping
– Further information in Zuo, Cererbral Cortex, 2012

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Graph-topological metrics
– Path Length

– Average Path Length

Wikipedia
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Graph-topological metrics
– Clustering Coefficient

– Small Worldness

Watts, Nature, 1998

– Problem: What is random, what is artificial?
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Graph-topological metrics
– Modularity:

– within module connections
- (inter module connections)^2
Wikipedia
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Graph-topological metrics
– Pro:
• Many of these Measures are quite intuitive
– Con:
• The topology itself is reduced to a single
number. To simplistic?
• Results are not very reliable

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Graph-topological metrics
– Further Reading

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Predictive Modeling
– Supervised machine learning problem
– Targets of prediction: age, disease or cognitive
state
– Features are connectivity, centrality or topology
metrics
– To prevent over - fitting of the model one uses
cross validation

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Predictive Modeling: Predicting Age

Dosenbach, Science, 2010
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Predictive Modeling: Predicting Depression

Zeng, Brain, 2012
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Predictive Modeling: Predicting ADHD

Fair, Fron Hum, 2013
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Predictive Modelling
– Pro:
• Allows more complex interactions
– “multivariate like the brain”
• Closer to the single subject level
– Con:
• Complex models on high dimensional data with
very few samples (over fitting!)

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Graph Analysis / Graph Comparison
• Few samples
– Problem: Scanning is expensive
– Solution: Data Sharing Initiatives:
» ADNI (adni.loni.usc.edu/)
» ADHD200

(fcon_1000.projects.nitrc.org/indi/adhd200)

» ABIDE (fcon_1000.projects.nitrc.org/indi/abide)
» Human Connectome Project
(www.humanconnectome.org/‎)
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Software
• Preprocessing rs-fMRI:
– Nipype (nipy.sourceforge.net/nipype/)
– FCON1000 (nitrc.org/projects/fcon_1000/)
• Building graphs (learned here)
– Nipy and Numpy
– Matlab
• Visualizing Graphs
– brainGL (http://code.google.com/p/braingl/)
– Gephi (https://gephi.org/)
Boettger, IEEE TVCG, 2014

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Further Reading
• Varoquaux, Gaël, and R. Cameron Craddock.
"Learning and comparing functional connectomes
across subjects." NeuroImage 80 (2013): 405-415.
• Fornito, Alex, Andrew Zalesky, and Michael
Breakspear. "Graph analysis of the human
connectome: promise, progress, and pitfalls."
Neuroimage 80 (2013): 426-444.

Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Thank you
• Dept. of Neurology
• Resting State Group

Zuo, Cereb Cortex, 2012
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Appendix
• Ylipaavalniemi, 2005

Ylipaavalniemi, 2005
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Appendix
• Smith PNAS 2009

Smith, PNAS, 2009
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Appendix
• Smith PNAS 2009

Smith, PNAS, 2009
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

Appendix
• Preprocessing
1) discarding the first four EPI volumes to allow for signal
equilibration,

2) 3D motion correction
3) time series despiking,
4) 4D mean-based intensity normalization,

5) band-pass temporal filtering (0.01-0.1 Hz),
6) removing linear and quadratic trends and
7) regressing out eight nuisance signals (white matter, cerebrospinal fluid and six motion parameters).
Alexander Schäfer

Max Planck Institute for Human Cognitive and Brain Sciences

