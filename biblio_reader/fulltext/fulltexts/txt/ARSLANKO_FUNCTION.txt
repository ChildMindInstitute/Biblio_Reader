FUNCTIONAL MAGNETIC RESONANCE IMAGING (FMRI) SIMULATOR

A THESIS SUBMITTED TO
THE GRADUATE SCHOOL OF INFORMATICS
OF
THE MIDDLE EAST TECHNICAL UNIVERSITY

BY

KAMİL ARSLANKOZ

IN PARTIAL FULFILLMENT OF THE REQUIREMENTS FOR THE DEGREE OF
MASTER OF SCIENCE
IN
THE DEPARTMENT OF MEDICAL INFORMATICS

JULY 2015

FUNCTIONAL MAGNETIC RESONANCE IMAGING (FMRI) SIMULATOR

Submitted by Kamil ARSLANKOZ in partial fulfillment of the requirements for the
degree of Master of Science in the Department of Medical Informatics, Middle
East Technical University by,

Prof. Dr. Nazife BAYKAL
Director, Informatics Institute

___________________

Assoc. Prof. Dr. Yeşim AYDIN SON
Head of Department, Health Informatics

___________________

Assist. Prof. Dr. Didem GÖKÇAY
Supervisor, Medical Informatics, METU

___________________

Examining Committee Members
Assoc. Prof. Dr. Tolga Esat ÖZKURT
Medical Informatics, METU

___________________

Assist. Prof. Dr. Didem GÖKÇAY
Medical Informatics, METU

___________________

Assist. Prof. Dr. Aybar Can ACAR
Medical Informatics, METU

___________________

Dr. Emre BAŞESKİ
HAVELSAN

___________________

Dr. Nurcan TUNÇBAĞ
Medical Informatics, METU

___________________

Date: 07.07.2015

I hereby declare that all information in this document has been obtained and
presented in accordance with academic rules and ethical conduct. I also declare
that, as required by these rules and conduct, I have fully cited and referenced all
material and results that are not original to this work.

Name, Last name : Kamil ARSLANKOZ

Signature

iii

:

ABSTRACT

FUNCTIONAL MAGNETIC RESONANCE IMAGING (FMRI) SIMULATOR

ARSLANKOZ, Kamil
M.Sc., Department of Medical Informatics
Supervisor: Assist. Prof. Dr. Didem GÖKÇAY

July 2015, 87 pages

Functional magnetic resonance imaging (fMRI) utilizes the change in the
oxygenation of blood to predict active areas in the brain. fMRI consists of multiple
low resolution whole brain images, for which, the contrast difference in
corresponding voxels among all images are studied. In this study, an fMRI simulator
has been developed which generates customized 4D fMRI data that can be used as
a ground truth for comparing/benchmarking different fMRI analysis methods. This
simulator can be also used for educational purposes for hands-on study of several
aspects of the fMRI time series. Some of the strengths of this simulator with respect
to other simulators are as follows. The simulator is programmed in MATLAB and it
contains a GUI which facilitates its use. It allows an atlas (ICBM) to generate
multiple brain activations within pre-defined anatomical structures. It utilizes T2
MRI images to construct task related (event/block/mixed paradigms) or DMN
(Default Mode Network) 4D fMRI data. It is capable of simulating the effects of head
iv

movement, habituation, scanner drift and Gaussian noise. The simulator completes
realistic fMRI data generation on the order of minutes. The results produced by the
simulator are analyzed by popular fMRI analysis tools, FSL and AFNI. The estimation
of brain activations and the prediction of the embodied artifacts by FSL and AFNI
matched the simulation parameters with great certainty, verifying the quality of the
simulations.
Keywords: Functional Magnetic Resonance Imaging, fMRI Simulation, Artifact,
Region of Interest (ROI), DMN (Default Mode Network)

v

ÖZ

FONKSİYONEL MANYETİK REZONANS GÖRÜNTÜLEME (FMRG) BENZETİCİSİ

ARSLANKOZ, Kamil
Yüksek Lisans, Tıp Bilişimi Bölümü
Tez Yöneticisi: Yrd. Doç. Dr. Didem GÖKÇAY

Temmuz 2015, 87 sayfa

Fonksiyonel manyetik rezonans görüntüleme (fMRG) kandaki oksijenlenme
değişiminden yararlanarak beyindeki aktif alanları kestirir. fMRG düşük çözünürlüğe
sahip tam beyin görüntülerini toplar ve beyin hacimlerindeki tekabül eden
voksellerin kontrast farkını ölçer. Bu çalışmada, farklı FMRG analiz yöntemlerini
karşılaştırmak/kıyaslamak için temel doğru olarak kullanılabilecek özelleştirilmiş 4B
verisi üreten bir FMRG benzeticisi geliştirilmiştir. Benzetici, fRMG zaman serilerinin
birkaç yönünün eğitimsel olarak çalışılması için de kullanılabilmektedir. Bu
benzeticinin diğer benzeticilere kıyasla güçlü olduğu bazı yönler şunlardır: Benzetici,
MATLAB ile programlanmıştır ve kullanımı kolaylaştıran bir grafiksel arayüze
sahiptir. Önceden tanımlı anatomik yapılar içinde birden fazla beyin aktivasyonu
oluşturmak için bir atlas (ICBM) kullanımını sağlar. Benzetici; T2 MRG görüntülerini,
ilgilenilen alanı ve görev temelli (olay/blok/karma paradigmaları) ya da DMN
vi

(Default mode network – Varsayılan mod ağı) temelli 4B fMRG verisi için kullanır.
Benzetici; baş hareketlerini, alışkanlığı, tarayıcı sapmasını ve Gauss gürültüsünü
benzetebilmektedir. Benzetici, dakikalar içerisinde gerçeğe yakın fMRG verisi
oluşturabilmektedir. Benzetici tarafında oluşturulan sonuçlar yaygın kullanılan fMRG
analiz araçları(FSL ve AFNI) ile analiz edildi. FSL ve AFNI tarafından beyin
aktivitelerinin tahmin edilmesi ve içerilmiş artefaktların kestirimi, benzetici
parametreleri ile yüksek bir kesinlikle örtüşmüştür, bu da benzeticinin kalitesini
doğrulamaktadır.
Anahtar Kelimeler: Fonksiyonel manyetik rezonans görüntüleme, fMRG benzeticisi,
artefakt, DMN (Default mode network – Varsayılan mod ağı).

vii

In dedication to my dear daughters, Elif Deniz and Ayşegül Nehir. And to my wife.

vi

ACKNOWLEDGEMENTS

I would like to express the deepest appreciation to my advisor Assoc. Prof. Dr.
Didem GÖKÇAY, for her support and guidance throughout the preparation of this
thesis.
I would also like to thank all jury members for reviewing my thesis work, and Kemal
Doğuş Türkay, a former member of MetuNeuro Lab for initiating preliminary steps
for this study.

vii

TABLE OF CONTENTS

ABSTRACT ...............................................................................................................................................İV
ÖZ ...........................................................................................................................................................Vİ
ACKNOWLEDGEMENTS .........................................................................................................................Vİİ
TABLE OF CONTENTS ............................................................................................................................Vİİİ
LIST OF TABLES ........................................................................................................................................ X
LIST OF FIGURES ..................................................................................................................................... Xİ
CHAPTER
1. INTRODUCTION ................................................................................................................................... 1
2. BACKGROUND AND LITERATURE SURVEY ........................................................................................... 5
2.1
2.2

2.3

2.4

FUNCTIONAL MAGNETIC RESONANCE IMAGING PROCESS .......................................................................5
FMRI DESIGN TYPES ........................................................................................................................6
2.2.1 Block design (epoch related) ...........................................................................................7
2.2.2 Event-related design .......................................................................................................8
2.2.3 Mixed design .................................................................................................................10
2.2.4 Resting State fMRI - DMN .............................................................................................11
FMRI ARTIFACTS ..........................................................................................................................12
2.3.1 Scanner drift ..................................................................................................................12
2.3.2 Habituation ...................................................................................................................12
2.3.3 Subject Motion ..............................................................................................................13
2.3.4 Gaussian White Noise [7] ..............................................................................................13
FMRI SIMULATORS AT PRESENT ......................................................................................................13
2.4.1 Chris Rorden’s fMRI Design Software *11+ ....................................................................13
2.4.2 POSSUM (Physics-Oriented Simulated Scanner for Understanding MRI) [12] ..............13
2.4.3 A simulation toolbox for fMRI data: SimTB [13] ............................................................16
2.4.4 METU-fMRISim [14].......................................................................................................17

3. METHOD ............................................................................................................................................ 21
3.1

3.2

OVERVIEW OF THE METU-FMRISIM 2.0 .........................................................................................21
3.1.1 Task Related (Event, Block and Mixed) FMRI Data........................................................23
3.1.2 Default Mode Network (DMN) Related fMRI Data .......................................................35
3.1.3 Scanner Drift Artifact.....................................................................................................38
3.1.4 Habituation Artifact.......................................................................................................39
3.1.5 Gaussian White Noise ...................................................................................................41
3.1.6 4D fMRI Generation ......................................................................................................42
3.1.7 Development Environment ...........................................................................................45
3.1.8 Boundary Conditions .....................................................................................................45
COMPARISON WITH OTHER SIMULATORS...........................................................................................45

viii

3.2.1
3.2.2
3.2.3
3.2.4

Comparison with POSSUM ........................................................................................... 45
Comparison with SimTB ............................................................................................... 46
Comparison with Chris Rorden’s fMRI Design Software .............................................. 46
Comparison with METU-fMRISim ................................................................................. 47

4. RESULTS ............................................................................................................................................. 49
4.1

4.2

4.3
4.4
4.5
4.6

4.7

VERIFICATION OF GENERATED ACTIVITY ........................................................................................... 49
4.1.1 Verification for Sample Block Design ........................................................................... 49
4.1.2 Verification for Sample Event Design ........................................................................... 51
VERIFICATION OF MOTION ARTIFACT ............................................................................................... 53
4.2.1 Rotation ........................................................................................................................ 53
4.2.2 Translation .................................................................................................................... 54
VERIFICATION OF DRIFT ARTIFACT ................................................................................................... 55
VERIFICATION OF HABITUATION ...................................................................................................... 56
VERIFICATION OF NOISE ................................................................................................................ 58
ICA ANALYSIS ON TASK RELATED FMRI DATA................................................................................... 59
4.6.1 ICA Analysis on Rigid Body Motion Artifact Signal ....................................................... 59
4.6.2 ICA Analysis on Drift and Noise Artifact Added fMRI Data ........................................... 62
ICA ANALYSIS ON DMN RELATED FMRI DATA ................................................................................. 64

5. DISCUSSION AND CONCLUSION ........................................................................................................ 67
REFERENCES .......................................................................................................................................... 71
APPENDICES .......................................................................................................................................... 75
APPENDIX A: USER MANUAL ................................................................................................................. 75
APPENDIX B: DMN TEMPLATES ............................................................................................................. 85

ix

LIST OF TABLES
Table 3-1 Subject count and TR values of downloaded rsfMRI datasets ..............................................35
Table 3-2 Correlation matrix between subjects of a specific laboratory ..............................................36
Table 3-3 Boundary Conditions of the Simulator ..................................................................................45
Table 4-1 Block Design FMRI Simulation Parameters ...........................................................................49
Table 4-2 Event Related FMRI Simulation Parameters .........................................................................51
Table 4-3 Rotation data generated with Simulator ..............................................................................53
Table 4-4 Rotation Artifact Results .......................................................................................................54
Table 4-5 Translation data generated with Simulator ..........................................................................54
Table 4-6 Translation Artifact Results ...................................................................................................55
Table 4-7 Drift Artifact Parameters .......................................................................................................55
Table 4-8 Habituation Artifact Parameters ...........................................................................................57
Table 4-9 Motion Artifact Parameters ..................................................................................................58
Table 4-10 Correlation of DMN components 41-45 ..............................................................................66

x

LIST OF FIGURES
Figure 2-1 BOLD response function (Image adopted from [3]) .............................................................. 5
Figure 2-2 Sample fMRI experiment ...................................................................................................... 6
Figure 2-3 Block Design Pattern ............................................................................................................. 7
Figure 2-4 Sample Block Design with two experimental conditions ...................................................... 8
Figure 2-5 Event Related Design Pattern ............................................................................................... 8
Figure 2-6 Sample Event-Related Design with three conditions (Image adopted from [5]) .................. 9
Figure 2-7 Sample Slow Event-Related Design (Image adopted from [5]) ............................................. 9
Figure 2-8 Sample Rapid Event-Related Design ................................................................................... 10
Figure 2-9 Mixed Design ....................................................................................................................... 11
Figure 2-10 Sample scanner drift effect (Image taken from [8]) .......................................................... 12
Figure 2-11 Habituation effect (Image taken from [9]) ........................................................................ 12
Figure 2-12 Chris Rorden’s fMRI Design Software GUI (Image taken from *11+) ................................. 13
Figure 2-13 POSSUM GUI (Image taken from [12]) .............................................................................. 14
Figure 2-14 Sample tissue template ..................................................................................................... 15
Figure 2-15 Sample scale parameter file generated from “$FSLDIR/data/possum” directory ............ 15
Figure 2-16 Sample 3D T2* map generated from “$FSLDIR/data/possum” directory ......................... 16
Figure 2-17 SimTB spatial map (left), baseline map (right). (Images taken from [13]) ........................ 17
Figure 2-18 SimTB Image Series ........................................................................................................... 17
Figure 2-19 METU-fMRISim (Image taken from [14]) .......................................................................... 18
Figure 2-20 The main GUI of METU-fMRISim(Image taken from [14]) ................................................ 19
Figure 3-1 Overview of the simulator .................................................................................................. 22
Figure 3-2 Simulator GUI ...................................................................................................................... 23
Figure 3-3 ROI Selection flowchart ....................................................................................................... 24
Figure 3-4 ROI Selection GUI ................................................................................................................ 25
Figure 3-5 ROI Selection by drawing on the slices ............................................................................... 26
Figure 3-6 Sample T1 Label Definition, T1 Labels and T1 Template ..................................................... 27
Figure 3-7 ROI Selection by using Brain Areas ..................................................................................... 28
Figure 3-8 ROI Selection - Whole Brian as ROI ..................................................................................... 29
Figure 3-9 Flowchart o HRF time course generation ............................................................................ 30
Figure 3-10 Task List Window for Block (a), Event (b) and Mixed (c) Designs...................................... 31
Figure 3-11 Stimulus Function for Block (a), Event (b) and Mixed (c) Designs ..................................... 32
Figure 3-12 HRF plot ............................................................................................................................. 32
Figure 3-13 HRF Time Course Preview GUI .......................................................................................... 33
Figure 3-14 HRF Time Course – Block(a), Event(b), Mixed(c) ............................................................... 34
Figure 3-15 DMN Related FMRI Data section ....................................................................................... 37
Figure 3-16 Correlated signal generation - blue: original signal, red: generated signal (60%
correlation) ................................................................................................................................. 38
Figure 3-17 Scanner Drift Artifact Definition GUI ................................................................................. 38
Figure 3-18 Ideal fMRI time series (blue) and added scanner drift artifact (black) ............................. 39
Figure 3-19 Habituation Artifact Definition GUI ................................................................................... 40
Figure 3-20 Habituation artifact added HRF time course .................................................................... 40
Figure 3-21 Noise Definition GUI.......................................................................................................... 41
Figure 3-22 Noise added HRF time course ........................................................................................... 42
Figure 3-23 4D FMRI Generation.......................................................................................................... 43
Figure 3-24 Motion Artifact .................................................................................................................. 44
Figure 3-25 3D Rotation planes ............................................................................................................ 44
Figure 3-26 3D Translation planes ........................................................................................................ 44
Figure 4-1 Block Paradigm time course ................................................................................................ 50

xi

Figure 4-2 Block design FMRI analysis result (left) and ROI defined in the simulator (right)................51
Figure 4-3 Event Paradigm time course ................................................................................................52
Figure 4-4 Event related FMRI analysis result (left) and ROI defined in the simulator. ........................52
st
nd
rd
Figure 4-5 1 , 2 and 3 order drift artifacts (a, b, c respectively) ......................................................56
Figure 4-6 Habituation artifact – no lag ................................................................................................57
Figure 4-7 Habituation artifact – 10 seconds lag ..................................................................................58
Figure 4-8 Noise added signal ((a) active voxels, (b) passive voxels) ....................................................59
Figure 4-9 IC map of Component 1 .......................................................................................................60
Figure 4-10 Time courses of Components 1-7 (a-g in order) ................................................................61
Figure 4-11 IC Map of Component 8 .....................................................................................................61
Figure 4-12 Time course of Component 8 .............................................................................................62
Figure 4-13 IC Map of Component 1 .....................................................................................................62
Figure 4-14 Time course of Component 1 .............................................................................................62
Figure 4-15 IC Map of Component 2 .....................................................................................................63
Figure 4-16 Time course of Component 2 .............................................................................................63
Figure 4-17 Time courses of Components 3-21 (a-q in order) ..............................................................64
Figure 4-18 Components 40-44.............................................................................................................65
Figure A-1 FMRI Simulator Main Window screenshot ..........................................................................75
Figure A-2 Task Related FMRI Section...................................................................................................77
Figure A-3 Stimulus Active Points .........................................................................................................77
Figure A-4 HRF Time Course..................................................................................................................77
Figure A-5 HRF Formula Help Window..................................................................................................78
Figure A-6 ROI Selection window ..........................................................................................................79
Figure A-7 Habituation Artifact Definition ............................................................................................79
Figure A-8 HRF time course of habituation artifact added signal .........................................................80
Figure A-9 DMN Related FMRI Section .................................................................................................81
Figure A-10 Sample DMN Template Signal ...........................................................................................81
Figure A-11 Rigid Body Motion Artifact Definition Section ...................................................................82
Figure A-12 Gaussian White Noise Definition Section ..........................................................................82
Figure A-13 HRF time course of noise added signal ..............................................................................82
Figure A-14 Scanner Drift Artifact Definition Section ...........................................................................83
Figure A-15 HRF time course of drift added signal ...............................................................................83
Figure A-16 HRF time course of drift+noise added signal .....................................................................84
Figure A-17 FMRI Viewer window .........................................................................................................84
Figure B-1 DMN Templates ...................................................................................................................87

xii

CHAPTER 1

INTRODUCTION

MRI is a widely used tool providing high resolution images with good contrast
between different tissues. The fundamental mechanism behind MRI depends on the
magnetic property of the hydrogen atom. Nucleus of a hydrogen atom behaves like
a small magnet and nuclei can be manipulated so that they generate a signal that
can be mapped and turned into an image.
The hydrogen molecules in our body align with the direction of strong magnetic
field. When a radio frequency (RF) pulse is applied at the correct frequency,
hydrogen molecules absorb their energy and create a signal that is detected by RF
coils. By using 3 RF coils in x, y, z planes and changing RF frequency within short
intervals, 3D MRI signal can be generated [1].
Functional MRI (fMRI) is a method which enables MRI to measure the neuronal (or
glial) activity of the brain. When neuronal activity is increased, more oxygen is
needed for those activated brain areas. In order to supply more oxygen, the blood
flow to the active area increases. The oxygen is transferred to cells by hemoglobin
molecules. The oxygenated (oxygen loaded) form of hemoglobin is called as
oxyhemoglobin and deoxygenated is called as deoxyhemoglobin. Oxyhemoglobin is
diamagnetic but becomes paramagnetic when deoxygenated. This magnetic
behavior of deoxyhemoglobin leads to small differences in MR signal. The change in
MR signal is dependent on the degree of oxygenation. Measuring MRI signal during
this neuronal activity is called blood oxygenation level dependent (BOLD) imaging.
During fMRI process, low resolution whole brain BOLD images (i.e. volumes) are
collected several times to capture less than 5% increase in oxygeneation in active
brain areas [2].
In order to analyze the fMRI data, several techniques have been developed. The
developments of those techniques are mostly based on empirically gathered fMRI
images. Since ground truth is not known with this empirical approach, it is difficult
to measure the accuracy of the analysis method. This is also true for artifact
removal algorithms since it is difficult to measure the artifacts within empirically
gathered fMRI data. If we knew the ground truth data, then we could easily analyze
the fMRI analysis algorithm results, compare/benchmark different fMRI analysis
methods and develop new ones. However, the complexity of cognitive processes
and background spontaneous activity of the brain hinders producing ground truth in
actual brain images.
1

The motivation behind this thesis is generation of 4D fMRI data which facilitates use
of a simulated ground truth for comparing/benchmarking different fMRI analysis
methods. By using this ground truth, comparison of performance of new fMRI
analysis methods may be possible. The simulator can also be used for educational
purposes. For the ones who are interested in learning fMRI, this tool can be treated
as an educational tool.
In this thesis, we developed an fMRI simulator which is capable of generating task
related and resting state 4D FMRI data. The task related fMRI data generation
consists of event, block and mixed design patterns whereas the resting state mode
consists of default mode network (DMN) data generation. Habituation, scanner
drift, noise and motion are the artifacts that can be added to fMRI signal.
For the task related fMRI data generation; the duration of experiment and TR value
(time between consecutive 4D whole brain volumes) can be manipulated by the
user. For DMN related data generation, the duration is designed to have a fixed
value which is coming from resting templates but the TR value is user defined.
An important feature of the simulator is the ability to define different sets of ROIs
for brain activity. For the task related fMRI data generation, 4 types of ROI selection
was implemented to define the active voxels: ROI selection by drawing free form
canvas, ROI selection by selecting a point of interest, ROI selection from atlas labels
and finally the entire brain as a single ROI. Two types of activation patterns were
designed: Event related and block activity patterns. By indicating active time points
for events and active intervals for blocks, fMR time series can be generated. Mixed
design was the combination of event and block activation design types. BOLD
response shape and the amplitude of BOLD response are parametric within the
simulator.
For the DMN related fMRI data generation, the active areas are limited to 6:
Anterior Cingulate Cortex (ACC), Posterior Cingulate Cortex (PCC), Right Inferior
Parietal Lobule (rIPL), Left Inferior Parietal Lobule (lIPL), Dorsomedial Prefrontal
Cortex (dmPFC), Ventromedial Prefrontal Cortex (vmPFC). These brain areas are
selected because of higher correlation with DMN activity. While generating DMN
time series, template signals that are previously uploaded to fMRI data repositories
are exploited. This way, DMN simulation is targeted to produce data close to real
life conditions. In this mode, signal correlations with the chosen template signal and
signal amplitudes are designed to be parametric.
Artifacts are defined as add-on components of the fMRI time series. Rigid body
rotation and translation are implemented in 3D plane to accomplish motion artifact.
The center of rotation and translation is selected as the middle voxel of the brain
volume. Sudden motion changes or changes within an interval are also supported.
For the scanner drift artifact; 1st, 2nd and 3rd degree polynomials are used.
Gaussian white noise is used to add random noise to fMRI data. For the habituation
artifact, the signal was decreased according to a parametrized habituation weight.
Overall, we created a user friendly fMRI simulator with features that are important
for current cognitive neuroscience applications. The main difference between our
2

simulator and the existing ones (Chris Rorden’s fMRI Design Software [11], SimTB
[13], POSSUM [12] and METU- fMRISim [14]) are as follows.
Chris Rorden’s fMRI Design Software [11] is a tool for only designing an fMRI study,
but it does not provide 4D fMRI output and artifacts cannot be defined with this
simulator. SimTB [13] is an fMRI simulator which has the capability of creation and
manipulation of spatial sources, block and event-related design experiments,
inclusion of tissue-specific baselines and simulated head movement. It has a GUI to
design and execute simulations. Unfortunately, SimTB calculates the time course of
single axial slice. Besides, no artifact other than motion can be generated with
SimTB. POSSUM (Physics-Oriented Simulated Scanner for Understanding MRI) is a
tool for generating simulated MRI and fMRI images. POSSUM is developed under
FSL (FMRIB's Software Library) [12]. POSSUM collects several MR parameters
(relaxation times T1, T2*, spin density ρ, and chemical shift value δ), pulse sequence
(RF angle, RF frequency bandwidth, RF center frequency), slice profile as well as a
pre-generated 4D activation file from the user in order to simulate the fMR time
series using a mathematical model (i.e. Bloch equations) rather than utilizing an
algorithm. This is somewhat inconvenient because it requires deep knowledge on
MR physics and it takes more than 40 hours to complete. With respect to artifacts,
POSSUM is limited to use motion and noise artifacts. Finally, METU-fMRISim is an
fMRI simulator capable of simulating block and event-related 4D fMRI data with
several artifacts: motion, scanner drift, habituation and cardiac pulsation. However,
it does not use a T2 weighted image as a baseline. It generates the fMRI data for a
flat image which is registered to the T1 weighted anatomic image.
The layout of this thesis is as follows. In chapter 2, background and literature survey
is presented. In chapter 3, methods which were used in order to implement this
simulator are discussed. Chapter 4 and 5 consists of simulation results and
conclusion parts respectively.

3

4

CHAPTER 2

BACKGROUND AND LITERATURE SURVEY
This chapter is composed of four sections: Functional Magnetic Resonance Imaging
Process, fMRI design types, fMRI artifacts and existing fMRI simulators at present. In
“Functional Magnetic Resonance Imaging Process” section; a general overview of
fMRI is presented. In “fMRI design types” section; task related fMRI (block, event
and mixed design types) and default mode network (DMN) related fMRI, which
consists of spontaneous baseline brain activity are explained. In “fMRI artifacts”
section, different types of fMRI artifacts are identified. In “fMRI Simulators at
present” section, already developed fMRI simulators are described.
2.1 Functional Magnetic Resonance Imaging Process
The main principle of fMRI is based on detecting neuronal activity changes from
differences in local concentrations of deoxyhemoglobin (dHb) and oxyhemoglobin
(HbO2). Oxyhemoglobin is diamagnetic (i.e. does not change MRI signal) but
deoxyhemoglobin is paramagnetic (i.e. changes MRI signal). When dHb decreases,
the spoiled T2* signal increases, and this is detectable as a small signal intensity
improvement. Because neural activity increases HbO2, the density of dHb in the
bloodstream decreases, which in turn registers as an increased signal. “The BOLD
Contrast refers to the difference in T2* signal between oxygenated (HbO2) and
deoxygenated (dHB) hemoglobin.” *3]. Figure 2-1 shows the BOLD response
function of a single brain voxel assuming that a stimulus is presented a time zero
causing the neuronal bed captured within the voxel to respond.

Signal Change(%)

1
Peak
UnderShoot

0

Time(seconds)

Figure 2-1 BOLD response function (Image adopted from [3])

5

From the figure above, we can see that the response cycle lasts for about 30
seconds. In the figure, stimulus is presented at time t=0. After stimulus is presented,
an initial deep is observed at first. Then signal changes to its maximum value at
about t=6. After that, undershoot occurs at about t=16 and signal returns to its
initial state at t=30. [3]
In fMRI experiments, low resolution whole brain volumes (generally >100) are
collected. Collection period of the entire brain volume is less than 3 seconds. The
voxel sizes are typically between 2mm x 2mm x 2mm – 3mm x 3mm x 3mm [4]. In
Figure 2-2, a sample event related fMRI experiment which has 2 stimuli conditions
(red and green arrows stand for events of two different conditions) is shown. During
the experiment, several 3D low resolution MRI scans of brain take place. In the
figure below, there are n volumes of the brain MRI during a single fMRI scan. If the
time between 2 consecutive volume scans is tvolume seconds, then experiment would
last in n x tvolumeseconds.

Stimulus

3D
Volume 1

3D
Volume n

Volume
Collection

Experiment Duration = n x tvolume;
Figure 2-2 Sample fMRI experiment
(n: number of volumes, tvolume: Brain Volume collection time)
2.2

fMRI design types

In order to design fMRI experiments, several experiment design types are used.
Block, event and mixed designs are well-known fMRI experiment design types used
in fMRI studies.

6

2.2.1 Block design (epoch related)
For the block design, stimuli (many stimuli of the same type) are presented to
subjects during ON periods and subject rests in OFF periods [3]. Sample block design
can be seen in Figure 2-3. In the figure, ON and OFF periods are shown. Note that
each ON period ends with an OFF period and vice a versa. A typical time frame for
the blocks is on the order of 10-40 sec.
ON
OFF

ON

ON

ON

OFF

OFF

OFF

Figure 2-3 Block Design Pattern
For the block design, more than one condition may also exist in an experiment [5]. A
sample experiment showing more than one condition can be seen in Figure 2-4. In
the figure, two conditions are tested: pictures (red blocks) and words (green
blocks). In the figure it is seen that the HRF response to words is higher than
pictures since the amplitude of HRF is higher for words. The Figure 2-4c is the sum
of individual HRFs shown in Figure 2-4b.
Stimulus Event

(a)
Individual HRF for each stimulus:

(b)

7

The sum of HRFs:

(c)
Figure 2-4 Sample Block Design with two experimental conditions
(Image adopted from [5])
With block design, hemodynamic responses of blocks can be compared to each
other or compared to baseline (i.e. rest or OFF). Block design is not used to compare
individual trials [5].
2.2.2 Event-related design
For the event related design, stimuli are presented at random times during the
experiment. Sample event design can be seen in Figure 2-5. From the figure, it can
be seen that the time difference between 2 consecutive events are not
homogeneous during the experiment.
stimuli

time
Figure 2-5 Event Related Design Pattern
In an event-related design, more than one condition may exist in the experiments
[5]. A sample experiment showing more than one condition can be seen in Figure
2-6. In the figure, three conditions are tested which are shown in Figure 2-6a. The
individual responses are shown in Figure 2-6b. In Figure 2-6b, it can be observed
that Stimulus C has higher response that Stimulus A and Stimulus A has higher
response than Stimulus B. Figure 2-6c is the sum of individual HRFs shown in Figure
2-6b.

8

Stimulus Event

(a)
Individual HRF for each stimulus:

(b)
The sum of HRFs:

(c)
Figure 2-6 Sample Event-Related Design with three conditions (Image adopted from
[5])
With event-related design it is possible to present stimuli in random order which is
not possible with block design. [5]
Event-related design falls into two categories: slow event-related design and rapid
event-related design. With slow event-related design, the stimuli are spaced far
apart from each other to prevent overlap of their hemodynamic functions. In such a
slow event-related design, time intervals between stimulus presentations range
from 15-30 seconds as can be seen in Figure 2-7.

Figure 2-7 Sample Slow Event-Related Design (Image adopted from [5])
With rapid event-related design, the stimuli are close to each other and their
hemodynamic functions overlap. Samples of rapid event-related designs can be
seen in Figure 2-8. In Figure 2-8a, non-random and fixed ISI (inter stimulus interval)
9

event related design is shown. It can be seen that the interval between 2
consecutive stimuli are same throughout the experiment. Such events are
scheduled on the order of 1-3 sec in between. Also the order of stimuli is not
random (i.e blue-cyan- yellow, blue-cyan- yellow, blue-cyan- yellow). In Figure 2-8b,
random and fixed ISI (inter stimulus interval) event related design is shown. It can
be seen that the interval between 2 consecutive stimuli are same throughout the
experiment but the order of stimuli is random. In Figure 2-8c, jittered ISI (inter
stimulus interval) event related design is shown. It can be observed that ISI is
dynamic and order of stimuli is random.

(a)

(b)

(c)
Figure 2-8 Sample Rapid Event-Related Design
(a: nonrandom and 3 seconds fixed inter stimulus interval, b: random and 3 seconds
fixed inter stimulus interval, c: random and jittered inter stimulus interval) (Image
adopted from [5])
2.2.3 Mixed design
Mixed design is the mixture of event-related design and block design [6] which can
be seen in Figure 2-9. From the figure it can be seen that there are ON-OFF periods
which is coming from the block related fMRI design. It can also be seen that during
ON periods, 0 or more events exists which in turn is the nature of mixed design.

10

ON
OFF

ON

ON

OFF

OFF

ON
OFF

Figure 2-9 Mixed Design
2.2.4 Resting State fMRI - DMN
Most of the fMRI experiments are accomplished by doing an active task (like
pushing a button) [28]. On the contrary, in resting state MRI (rsFMRI) experiments,
data is collected while subject is doing nothing (i.e. resting). During this condition
(i.e. doing nothing) different areas of brain may act together in synchrony. For
functional connectivity, it is not a requirement for areas to be physically connected
[28]. There may still be connectivity if there is synchronization between them.
DMN is one of the resting state networks. “Default mode” term was first used by Dr.
Marcus Raichle in 2001 [28] [31]. During the rest, DMN network becomes active.
But it becomes passive when a task is initiated.
The brain areas which are included in DMN are medial temporal lobe, the medial
prefrontal cortex, and the posterior cingulate cortex, as well as the ventral precuneus and parts of the parietal cortex [29]. These areas are mostly related with
some kind of internal thoughts [28].
Because DMN is active at rest and due to the brain areas included in DMN; DMN is
thought to be associated with introspective thought, including activities like
daydreaming or retrieving memories [28].
In the study of Damoiseaux et al. [32], different kinds of coherent low-frequency
fluctuations in the BOLD signal are identified across subjects. The study showed that
the coherent fluctuations within DMN are very consistent and also very dynamic.
The percentage BOLD signal change in these areas reach up to 2–3%, and areas with
high mean percentage BOLD signal change also show high levels of consistency. As a
result the signal being measured during resting state fMRI data acquisition is not an
artifact caused by another physiological function [32].
Meta-analysis of the brain regions that are active during rest (passive state) indicate
several correlated ROIs [34]. The first study was conducted by Shulman and
colleagues (1997) [35] to determine the brain areas that are active during passive
rest. In order to achieve this, the data of 132 normal adults were collected both
active condition (stimulus was presented and subjects performed tasks) and passive
condition (same stimulus was presented with no given task). Similar approach was
used by Mazoyer et al. (2001) on 63 subjects [36]. These two analyses revealed
consistent brain regions that are more active during passive condition than active
condition.

11

2.3

fMRI artifacts

Some of the artifacts that are added onto the signal are due to physical strain of the
device, and some of the artifacts are originate from the human subject being
scanned.
2.3.1 Scanner drift
Scanner drift is mostly occurs because of the instability of gradient coils which
causes a drift in magnetic field strength. This drift in magnetic field strength causes
a drift in the acquired signal which is called “scanner drift”) *7]. Figure 2-10 shows
the sample scanner drift effect. From the figure, a linear drift (increase in baseline
signal) in fMRI data can be observed easily as a baseline increase in the fMRI signal
over time.

Drift in signal

Figure 2-10 Sample scanner drift effect (Image taken from [8])
2.3.2 Habituation
“Neural responses tend to be stronger to novel information than to repeated
information (for recent reviews, see Grill-Spector et al., 2006; Krekelberg et
al., 2006; Schacter et al., 2007)” *9]. For this reason, BOLD increase in repeated
tasks is much less compared to novel stimuli which can be observed in Figure 2-11.
From the figure it can be seen that novel information has higher fMRI signal
increase than repeated information. Although this is not an artifact, we
incorporated such signal changes into our simulator as a manipulation similar to
artifacts.

Figure 2-11 Habituation effect (Image taken from [9])
12

2.3.3 Subject Motion
Subject motion is an important artifact. Motion leads to abrupt signal intensity
changes and it is sometimes indistinguishable from neuronal activity, if it occurs at
task-related time intervals [10+. “Even relatively small motion (of the range much
smaller than a voxel size e.g. 1.6-3.2 mm) can create serious artifacts due to the
partial volume effects.” *3]
2.3.4 Gaussian White Noise [7]
All MR imaging can be affected by thermal noise. Thermal noise is mostly caused by
electronics within the MR imaging device. Thermal noise may be added to or
subtracted from the intensity resulting in a Gaussian distribution.
2.4

fMRI Simulators at present

2.4.1 Chris Rorden’s fMRI Design Software [11]

Figure 2-12 Chris Rorden’s fMRI Design Software GUI (Image taken from *11])
This software is a tool for just designing an fMRI study. The tool does not provide 4D
fMRI output. It shows HRF time course of an experiment by using the settings (like
TR, number of volumes, design type etc.) which are defined by user.
Block and event related BOLD responses can be viewed with the simulator. For the
block design, the length of activation should be same for each stimulus (condition).
For the event related design; fixed inter stimulus interval, exponential inter stimulus
interval and random inter stimulus intervals are implemented. But the user has no
control on the time of events.
2.4.2 POSSUM (Physics-Oriented Simulated Scanner for Understanding MRI) [12]
POSSUM is a tool for generating simulated MRI and fMRI images. POSSUM is
developed under FSL (FMRIB's Software Library). In order to generate MRI data,
POSSUM uses Bloch equations, as well as geometric definition of the brain. The GUI
of POSSUM is given in Figure 2-13.
13

Figure 2-13 POSSUM GUI (Image taken from [12])
Some of the important parameters are as follows.


Object: The input object is a 4D volume which is combination of 3D tissue type
volumes. Each tissue type (CSF, white matter, grey matter etc.) is defined as a
3D image volume. 4D fMRI volume is created by combining these 3D volumes.

14

Figure 2-14 Sample tissue template
(grey matter, white matter and CSF from left to right) (Image taken from [12])


MR parameters: The MR parameters for the Bloch equations1 (relaxation times
T1, T2*, spin density, and chemical shift value) are specified for each tissue type.



Pulse sequence: The pulse sequence defines flip angle, RF frequency bandwidth,
RF center frequency, read-out times, and gradient waveforms



Slice profile: Describes the shape of the RF pulse in the frequency space.



Motion sequence: The input motion sequence is defined in the simulator by an
input file which specifies 7 parameters per motion: time, translation at each
orientation and rotation at each orientation.



B0 inhomogeneities: B0 inhomogeneities define distortion in the local magnetic
field such as tissue-air interfaces

For generating a 4D dataset, time series must be obtained for each voxel. For this
purpose, files can be prepared by drawing areas of interest in “fslview” and then
creating a modulation time-course file which matches your experimental paradigm
or existing FMRI files under $POSSUM can be used. In the 4D data, each object
voxel has its own time-series of T2* changes. Instead of using 4D data, 3D T2* map
and an extra file providing the scaling parameter can also be used. Sample scaling
parameter file and 3D T2* can be seen in Figure 2-15 and Figure 2-16 respectively.

Figure 2-15 Sample scale parameter file generated from “$FSLDIR/data/possum”
directory
1

Bloch equations are as follows:

15

Figure 2-16 Sample 3D T2* map generated from “$FSLDIR/data/possum”
directory
After running POSSUM, 4D fMRI data is generated as an output. In order to
generate a time series of 100 fMRI volumes for 3 slices of 3mm thickness, with an
output k-space matrix of 64 × 64 for each slice with no motion, it takes 42 hours 30
minutes on a single processor.
In order to run the POSSUM, the MR parameters should be defined at first. The MR
parameters cannot be defined without deep knowledge on MR physics. Besides,
activation file should be defined in order to define fMRI activation. For this, 4D or
3D+scaling parameter file should be prepared with other utilities. This means that
POSSUM can be used efficiently only by professionals. Also with 3D+scaling file it is
not possible to define different activations per ROI. For the artifacts; POSSUM does
not take any artifact into account other than motion artifact. And it takes too much
time to generate fMRI volumes. In sum, although POSSUM generates fMRI data by
considering physics of the underlying measurements, it has several shortcomings
for its use to mimic data obtained from a cognitive neuroimaging experiment.

2.4.3 A simulation toolbox for fMRI data: SimTB [13]
SimTB is an fMRI simulator which has the capability of creation and manipulation of
spatial sources, block and event-related design definition, inclusion of tissue-specific
baselines and simulated head movement. It has a GUI to design and execute
simulations.
16

SimTB defines spatial maps (SM) which can be seen in Figure 2-17a. Components in
SM are the components commonly seen in axial slices of real fMRI data.
Components have default baseline values (see Figure 2-17b) which could be
changed by user.

(a)

(b)

Figure 2-17 SimTB spatial map (left), baseline map (right) (Images taken from [13])
In order to generate fMRI data; time courses (TC) of each component is calculated
by convolution of task time series with hemodynamic model. Then TCs are
multiplied with the baseline values of components. Motion and noise are added to
get the final fMRI data. The result is 3D image where 2D square image (single slice)
is convolved with hemodynamic model over the time which can be seen in Figure
2-18.

Image 1
(2D)

Image n
(2D)
(n: # time pts)

Figure 2-18 SimTB Image Series
As a result, SimTB does not generate 4D fMRI output. Instead, it generates 3D FMRI
output where a single 2D slice is updated over the time to have 3D result.
2.4.4 METU-fMRISim [14]
METU-fMRISim is an fMRI simulator capable of simulating 4D fMRI data with several
artifacts: motion, scanner drift, habituation and cardiac pulsation. The flowchart of
METU-fMRISim can be seen in Figure 2-19 and the GUI of the simulator can be seen
in Figure 2-20.

17

Figure 2-19 METU-fMRISim (Image taken from [14])

18

Figure 2-20 The main GUI of METU-fMRISim(Image taken from [14])
(b(i): block paradigm, e(i): event-related paradigm, gs(i): Gaussian convolution,
d(i):scanner drift, c(i):cardiac pulsation, h(i): habituation, M: motion )
In order to generate 4D fMRI data, time courses are calculated by convoluting HRF
with task waveform (event or block designs are used to compute time series) and
adding baseline value to the convolution result. Scanner drift, habituation and
cardiac pulsation artifacts are added to the calculated time course signal. The
resulting signal is then convolved in spatial domain with 3x3x3 Gaussian kernel.
Final fMRI data is calculated after adding motion to convolved signal. METUfMRISim uses the same baseline value for all voxels of the brain. However this is not
true since each voxel may have a different offset value. For example voxels
belonging to white matter and voxels belonging to gray matter have different
intensities. Besides, it is very hard to define the ROI with this simulator. Also only
one condition can be represented. For the block paradigm, the durations are same
and only ON-OFF is handled. The amplitude of BOLD response cannot be defined
with the simulator. In sum, the simulator has overbearing limitations.

19

20

CHAPTER 3

METHOD
This chapter includes 2 sections. In section 1, “Overview of the METU-fMRISim 2.0”
is presented. In the “Overview of the METU-fMRISim 2.0” section; ROI Selection,
HRF time course generation and 4D fMRI generation are explained. In section 2,
METU-fMRISim 2.0 is compared with other fMRI simulators.

3.1

Overview of the METU-fMRISim 2.0

An fMRI simulator has been developed which is capable of generating 4D fMRI data
based on user selected active voxels (ROI), experiment settings and artifacts.
In order to generate 4D fMRI data, 5 phases (Paradigm Selection, ROI Selection,
HRF/DMN signal generation, Scanner Drift/Habituation artifacts addition and 4D
fMRI generation) are followed in order. The overview of the simulator can be seen
in Figure 3-1.

21

Paradigm
Selection

T1 template

HRF formula

ROI Selection

Previously defined
ROIs

HRF time course
generation for each ROI

Scanner Drift and
Habituation artifacts
addition

T2 template

DMN signal generation
for each ROI

Template signal +
Correlation weights

Scanner Drift artifact

4D FMRI generation

Motion and
Noise

4D FMRI

Figure 3-1 Overview of the simulator
The GUI of the simulator can be observed in Figure 3-2. In the GUI, there are 4
major parts: Experiment Settings (in blue), Task Related (Event, Block and Mixed)
FMRI Data (in green), Default Mode Network (DMN) Related FMRI Data (in yellow),
artifacts definition (rigid motion, noise and scanner drift – shown in red) and 4D
fMRI generation (in black). The details of the simulator GUI is described in later
sections.

22

Figure 3-2 Simulator GUI
3.1.1 Task Related (Event, Block and Mixed) FMRI Data
3.1.1.1 ROI Selection
In order to generate task related fMRI data, ROI should be defined since only voxels
within an ROI will have hemodynamic activation. By using 3D T1 template file [4], T1
Template Label Definition file [15] and 3D T1 Template label file [15]; the user
defines ROI either “by drawing on T1 slices”, “by selecting previously defined brain
areas from a labeled template” or selects “whole brain” as ROI. After ROI is defined,
it is saved by user. In the saved ROI file; values greater than “1” corresponds to
active voxels and “0” corresponds to passive ones. Figure 3-3 describes the overall
flowchart of ROI Selection.

23

Active Voxel(ROI) Selection

By drawing
on slices

Whole Brain

3D T1 Template

By selecting
predefined brain
areas

3D T1 Template Label, T1
Template Label Defn.

Saving ROI

3D ROI

Figure 3-3 ROI Selection flowchart
The GUI of ROI Selection can be observed in Figure 3-4. In the figure, there are 4
major parts: Top (red dashed lines) is the sagittal, axial and coronal views, bottom
(blue dashed lines) is the ROI selection types, middle (green dashed lines) is list of
selected ROIs and bottom right (black dashed lines) is file name to be saved.

24

Figure 3-4 ROI Selection GUI

3.1.1.1.1 ROI Selection by drawing polygon/point on the slices
The type of ROI could be either Point or Polygon. For the point case; user selects a
single active voxel by pressing mouse button on the selected slice (sagittal, coronal
or axial). If the selection is Polygon, then user defines edge points by pressing
mouse on the selected slice (sagittal, coronal or axial). For both cases, selected
voxels are shown in blue. Polygonal and Point selection can be defined on multiple
slices so that user can define any number of polygons/points on any slices. For
example, a polygonal area is selected on the sagittal slice in Figure 3-5.

25

Figure 3-5 ROI Selection by drawing on the slices

3.1.1.1.2 ROI Selection by previously defined brain areas
Predefined brain areas are selected from ICBM as templates “T1 Template Label
Definition file” *15] and their associated anatomical labels are defined in “3D T1
Template Label” image file *15+. In the “T1 Template Label Definition” file, each
brain area is associated with a numeric value which is referencing to the “3D T1
Template Label” image file. Since 3D T1 Template Label and 3D T1 Template image
files are registered to each other, the corresponding voxels of brain areas could be
identified in 3D T1 Template image.
Sample T1 label definition, 3D T1 labels and 3D T1 template are shown for a 3x3
area in a single slice in Figure 3-6. As can be seen “Amygdala” is labeled as “240” in
Template Label Definition file. When we look at the 3D T1 Template Label image
file, we can see that the voxel at the top-right most is associated with Amygdala
label. Since 3D T1 Template Label and 3D T1 Template are registered to each other
we can easily say that the intensity value of 254 is a voxel from Amygdala.

26

Amygdala

240

…

…

Putamen

14

….

….

T1 Template Label Definition

1

14

240

1234 1846

254

3

8

14

300

76

1745

5

23

32

123

432

487

3D T1 Template Label

3D T1 Template
intensities

Figure 3-6 Sample T1 Label Definition, T1 Labels and T1 Template
Predefined templates are listed in the ROI Selection GUI which can be seen as the
red colored area in Figure 3-7. In order to select brain area(s) as ROI, user selects
active brain area and presses “” button. The selected brain area is shown in blue
on the GUI which means that those voxels will have neuronal activity.
For example “Hippocampus” is selected in Figure 3-7 and shown in blue. It means
that voxels of Hippocampus will have neuronal activity only.

27

Figure 3-7 ROI Selection by using Brain Areas

3.1.1.1.3 ROI Selection-Whole Brain as ROI
The whole brain can also be defined as a ROI. In order to select whole brain as a
ROI, “Whole Brain” radio button selection is selected and “Add” button is pressed.
In Figure 3-8, whole brain is selected as a ROI.

28

Figure 3-8 ROI Selection - Whole Brian as ROI

3.1.1.2 HRF Time Course Generation
Figure 3-9 describes the overall flowchart of HRF time course generation. According
to the figure, stimulus function can fall into category of Event, Block or Mixed
paradigms. At first task waveform is generated by using experiment duration and
paradigm type values. Task waveform consists of the time spots of previously
assigned stimulus conditions. It is the basic design of the experiment. Then resulting
ideal fMRI signal is obtained by convolving the task waveform with HRF function as
described in section 3.1.1.2.2. Then Gaussian White noise and Scanner
Drift/Habituation artifacts are added onto this ideal signal to make it closer to the
observed fMR time series which includes artifacts.

29

Paradigm
Selection

Event
points

Block points

Mixed
points

Task waveform
Generation

Experiment
Duration

Convolution with HRF

Gaussian White Noise

Scanner Drift and
Habituation artifacts

Simulated fMRI Time Course

Figure 3-9 Flowchart o HRF time course generation
3.1.1.2.1 Stimulus Function
There are 3 types of task waveforms that can be defined: Event, Block and Mixed.
As shown in Figure 3-10a and Figure 3-10b, event points are entered with comma
separated and blocks are entered in “a-b” form where a is the starting time and b is
the ending time in seconds (blocks are also separated with comma). For the mixed
design (as shown in Figure 3-10c), user can enter the values in block and event type
formats at the same time. When the user presses the Preview button, stimulus
function can be seen as a plot.

30

(a)

(b)

(c)
Figure 3-10 Task List Window for Block (a), Event (b) and Mixed (c) Designs
Figure 3-11a , Figure 3-11b and Figure 3-11c are the samples of task waveforms for
block, event-related and mixed design types respectively. In Figure 3-11a, there are
2 conditions for the block design. The amplitudes of HRF response of conditions are
3.5 and 4%. From the figure it is seen that the dark blue colored condition will have
a higher HRF response. In Figure 3-11b, 2 conditions for an event related fMRI
design is shown. The amplitude of HRF responses are 1.5 and 1% for dark blue and
light blue respectively. In Figure 3-11c, mixed design is shown. It can be seen that
there are 2 conditions for mixed design. One for the block design and the other for
the event related design. The amplitude of block is 3% and event is %1. During the
experiment, a single event occurs during the active blocks.
31

(a)

(b)

(c)

Figure 3-11 Stimulus Function for Block (a), Event (b) and Mixed (c) Designs

3.1.1.2.2 Hemodynamic Response Function (HRF)
The HRF acts as an impulse response function in generating ideal (i.e. expected)
fMRI time series from a given task waveform. A task waveform can be thought as a
combination of several impulses. The HRF is a linear combination of two Gamma
Functions is shown below:

( )

(

)

(

)

where t references time, α1 = 6, α2 = 16, β1 = β2 = 1 and c = 1/6 [16]. Γ represents
the gamma function. Following figure is the plot of HRF.

Figure 3-12 HRF plot
The HRF formula is used to simulate the HRF time course of block, event and mixed
designs which is described in the section below.
3.1.1.2.3 Ideal fMRI response

32

The ideal fMRI response, HC, for a given task waveform, fs is calculated by using the
formula below:
( )

( ( ))
where “*” is the convolution operator.

In order to see the HRF time course, user presses Preview button under “Time
Course” pane which is shown in Figure 3-13.

Figure 3-13 HRF Time Course Preview GUI

33

(b)

(a)

(c)
Figure 3-14 HRF Time Course – Block (a), Event (b), Mixed (c)
Figure 3-14a shows the HRF time course of block paradigm. The corresponding task
waveform is the one shown in Figure 3-11a. From the figure we can see that the
amplitude of the time course is close to %3.5 and %4.
Figure 3-14b shows the HRF time course of event-related paradigm. The
corresponding stimulus function is the one shown in Figure 3-11b. From the figure
we can see that the amplitude of the time course is close to %1.5 and %1”.
Figure 3-14c shows the HRF time course of mixed paradigm. The corresponding
stimulus function is the one shown in Figure 3-11c. From the figure we can see that
the amplitude of the time course is close to %3 for blocks and %1 for events.

34

3.1.2 Default Mode Network (DMN) Related fMRI Data
3.1.2.1 DMN Template Generation
In order to generate signal templates for DMN Related fMRI Data Generation,
resting state fMRI data of 397 subjects were downloaded from the nitrc web site
[19]. Table 3-1 describes the source of data, number of subjects per source and TR
values about downloaded rsfMRI scans.
Table 3-1 Subject count and TR values of downloaded rsfMRI datasets
Data Source Laboratory
Number of Total Subjects TR Values (sec)
AnnArbor
22
2
Baltimore
23
2.5
Bangor
20
2
Berlin_Margulies
26
2.3
Cambridge_Buckner
48
3
Dallas
24
2
Leipzig
37
2.3
Oxford
22
2
Pittsburgh
17
1.5
Atlanta
28
2
Beijing_Zang
40
2
Cleveland
17
2.8
Newark
19
2
NewYork
41
2
Taipei
13
2
In the table above, there are 15 laboratories which provided resting state fMRI data.
The number of subjects and TR values of fMRI scans per laboratory can also be seen
in the table.
After that each subject was registered to MNI 152 Coordinate Space [20] having
4mm*4mm*4mm voxels. Then, for each subject, the mean signal was calculated for
6 brain areas which are Anterior Cingulate Cortex (ACC), Posterior Cingulate Cortex
(PCC), Right Inferior Parietal Lobule (rIPL), Left Inferior Parietal Lobule (lIPL),
Dorsomedial Prefrontal Cortex (dmPFC), Ventromedial Prefrontal Cortex (vmPFC).
After that the mean signal was interpolated to have TR values of 0.5 second. Then
subjects which have signal drift were removed from data set. After removal, 212
subjects remained to be template candidate.
In order to identify the template subject for each laboratory, normalized correlation
matrixes were calculated for each laboratory as follows: In order to calculate the
correlation matrix, the paired normalized correlations of the DMN signals between
35

the subjects within a laboratory are calculated. Then normalized correlation values
in the correlation matrixes [-1 1] were transformed into [100 0] interval where 0
stands for positive maximum correlation and 100 for negative maximum
correlation. This *100 0+ interval is interpreted as the “distance” between 2 values.
After that, transformed scores (distances) were summed for each subject as seen in
Table 3-2. The subject having minimum distance is selected as the template among
several subjects for that laboratory. The chosen template subject has the
representative data, because his/her rsfMRI data has the highest correlation with
that of other subjects.
Table 3-2 Correlation matrix between subjects of a specific laboratory
(transformed scores)
Laboratory 1..M Sub1
Sub2
…
SubN
Sub1

score11

score12

…

score1N

Sub2

score21

score22

…

…

…

…

…

…

…

SubN

scoreN1

scoreN2

…

scoreNN

score_sub1=

score_sub2=

∑

∑

SUM

score_subN=
…

∑

N: subject count for a laboratory, Subi: individual subjects
Selected template subject for a laboratory: min (score_subx) where x=1: N
Signals of selected template for each laboratory can be seen in
APPENDIX B: DMN TEMPLATES.
3.1.2.2 DMN fMRI Generation
As described in the previous section, there are 6 brain areas in which DMN related
fMRI is generated. In order to calculate a separate template signal for each brain
area, correlation values under Correlation Data Section shown in Figure 3-15 is
used. As a result, DMN resting state signal in each of the 6 areas exhibit a different
correlation coefficient with the chosen template signal.

36

Figure 3-15 DMN Related FMRI Data section
To calculate a resting-state correlated signal for a brain area (x: correlation value of
one of the brain areas shown in Figure 3-15.)[21]
1. Mean and standard deviation of template signal (template_signal) is calculated.
2. Gaussian random normally distributed signal (random_signal) is generated
having equal mean and standard deviation with template signal.
3. Then Cholesky decomposition, CHOL, of the matrix [
] is calculated where x
is the desired correlation (For example x is 0.9000 for ACC in Figure 3-15). The
Cholesky decomposition of [
] is in the form of [
]
4. Then M= [

] [

] is calculated by multiplying [

matrix with the matrix calculated at step 3 above ([

]).

5. Correlated signal is the second row element of matrix which is
template_signal*A+ random_signal*B
For example, Figure 3-16 shows original signal and generated signal which is 60%
correlated with original signal.

37

]

Figure 3-16 Correlated signal generation - blue: original signal, red: generated signal
(60% correlation)

3.1.3 Scanner Drift Artifact
Scanner Drift Artifact is calculated by using the formula below:
()

()

(

)

where TC(t) is the value of the ideal fMRI series at time t and SDA is the Scanner
Drift Artifact value.
Figure 3-17 shows the Scanner Drift Artifact Definition GUI and Figure 3-18 shows
Scanner Drift added signal.

Figure 3-17 Scanner Drift Artifact Definition GUI

38

(b)

(a)

(c)
Figure 3-18 Ideal fMRI time series (blue) and added scanner drift artifact (black)
(a) 1st degree,(b) 2nd degree and (c) 3rd degree scanner drift signal
In Figure 3-18, 3 types of scanner drift are shown: 1st, 2nd and 3rd degree scanner
artifacts. In Figure 3-18a, scanner drift calculated by using 1st degree polynomial is
shown. From the figure, it is seen that the fMRI time course increases over the time
linearly since 1st degree polynomial is used. In Figure 3-18b and Figure 3-18c,
scanner drifts calculated by using 2nd and 3rd degree polynomial are shown. From
the figures it is seen that the shapes of fMRI time course fits 2nd degree polynomial
and 3rd degree polynomial respectively.
3.1.4 Habituation Artifact
Habituation Artifact is calculated by using the formula below:
()

()

(
39

)

where TC(t) is the ideal fMRI time course value at time t and HA is the Habituation
artifact value.
Figure 3-19 shows the Habituation Artifact Definition GUI and Figure 3-20 shows
Habituation Drift added signal. Habituation value in this figure is the percentage of
the signal decrease over the time. Lag is the shift of the time course in time in
seconds. For example 10 seconds lag means that the time course will be shifted 10
seconds. This effect can be seen in the bottom part of Figure 3-20 where the time
course is shifted to right with an amount of 10 seconds.

Figure 3-19 Habituation Artifact Definition GUI

Figure 3-20 Habituation artifact added HRF time course

40

In Figure 3-20, it can be observed that the hemodynamic response decreases over
time which is the effect of habituation. The lag can be observed at the bottom of
the figure. The bottom left (cyan dashed) is the original signal whereas the bottom
right (black) is the lagging signal. It can be easily seen that the HRF time course is
shifted right which described the lag effect.
3.1.5 Gaussian White Noise
Gaussian White Noise is calculated by using the formula below where noise is just
normally distributed pseudorandom values with equal length of signal.
(√∑

)

(√∑

)

(

)

where Powersignal is the signal power, Powernoise is the noise power and Signalresult is
the final signal calculated.
Figure 3-21 shows the Noise Definition GUI and Figure 3-22 shows Noise added
signal.

Figure 3-21 Noise Definition GUI

41

Figure 3-22 Noise added HRF time course
In Figure 3-22, left side of the figure is the original signals and right side is Gaussian
White Noise added signals.
3.1.6 4D fMRI Generation
Figure 3-23 describes the overall flowchart of fMRI time course generation. The 3D
ROI and HRF Time course are the ones that were described in section 3.1.1.1 and
3.1.1.2. By using T2 template [17], 3D ROI and HRF time course 4D fMRI data was
generated. In order to generate 4D fMRI data following formula is used:
()

(

( ))

where 4DfMRI is the 4D fMRI data, T2 is the 3D T2 template[17], ROI consists of
active voxels described in section 3.1.1.1 and HRFT is the HRF time course described
in section 3.1.1.2.
After generation of 4D fMRI data, motion artifact is added to 4D fMRI data which is
described in section 3.1.6.

42

3D ROI

T2 template

fMRI Time course

4D FMRI generation
(without motion artifact)

Motion Generation

4D FMRI

Figure 3-23 4D FMRI Generation

3.1.6.1 Rigid Body Motion Artifact
Motion artifact is the rigid body rotation and translation of the head in sagittal, axial
and coronal planes. The rotation and translation can be any combination of these 3
planes in + or - directions. The unit of motion is degree per second. Rotational point
is the middle of sagittal, axial and coronal planes.
Figure 3-24 is an example of how rotation is entered. As seen from Figure 3-24,
there are four rotations. At 30th second, head is rotated at 1 degree in the axial
plane. At 40th second, head is rotated at 2 degrees in coronal plane. At 50 th second,
head is rotated negative (opposite) 3 degrees in sagittal plane. In the end, there is
total of 10 degrees rotation in 70-80 second time frame which means that head is
rotated in sagittal plane at 10 degree/(80-70)second= 1 degree per second.
43

Figure 3-24 Motion Artifact
Rotation and translation in 3D planes are explained in Figure 3-25 and Figure 3-26
respectively.

Figure 3-25 3D Rotation planes
(Left: Axial rotation, Middle: Coronal rotation, Right: Sagittal rotation)
(Image taken from http://www-psych.stanford.edu/~kalina/BB)

Figure 3-26 3D Translation planes
(Left: Axial translation, Middle: Coronal translation, Right: Sagittal translation)
(Image taken from http://www-psych.stanford.edu/~kalina/BB)

44

3.1.7 Development Environment
MATLAB was used as the programming language. In order to read/write ANALYZE
and NIFTI files, NIFTI Tools (Copyright 2009 Jimmy Shen) was used.
T1 template, T1 template labels and T2 atlas used within this application were
downloaded from http://www.loni.usc.edu/atlases website.
3.1.8 Boundary Conditions
There are some boundary conditions which should be taken into account when
running the simulator. The boundary conditions have been described in Table 3-3
Table 3-3 Boundary Conditions of the Simulator
Field/Data
Boundary
Experiment Length
Experiment length should not exceed 30 minutes
For the block design, block length should be in between
Block Length
20-30 seconds
Block Design HRF
For the block design, HRF Amplitude Percent should
Amplitude Percent
not exceed 5%
Event Design HRF
For the event-related design, HRF Amplitude Percent
Amplitude Percent
should not exceed 2%
Output voxel size in the simulator is fixed 4mm X 4mm
Output voxel size
X 4mm.
Time resolution within the simulator is 0.5 seconds.
Motion and tasks can be defined in the simulator is in
Time resolution
the increments of 0.5 seconds.
Habituation percentage is expected to be in between 0Habituation Percentage
1
Lag
Lag is expected to be in between 0-30 seconds
Scanner Drift
Expected to be in between 0-1
Scanner Drift Maximum
Amplitude
Expected to be in between %1-%10
Noise SNR
Value greater than 0
Values are in degrees. Expected to be in between 0-5
Rotation
degrees
Values are in voxels. Expected to be in between 0-5
Translation
voxels (0-20mm).
3.2

Comparison with Other simulators

3.2.1 Comparison with POSSUM
In POSSUM, in order to generate fMRI data, the MR Parameters (relaxation times
T1, T2*, spin density ρ, and chemical shift value δ), pulse sequence (RF angle, RF
45

frequency bandwidth, RF center frequency), slice profile and 4D activation file
should be provided. MR Parameters and pulse sequence parameters can only be
defined with deep knowledge on the MR physics. 4D fMRI Activation file should
also be defined in order to run POSSUM. With our simulator, 4D activation is
handled by providing ROI and the shape of HRF which could be defined by the user.
For the artifacts, POSSUM is limited to use motion and noise artifacts whereas our
simulator also simulates drift and habituation artifacts. Running POSSUM takes too
much time (For 100 fMRI volumes with 3 slices of 3mm thickness, with an output kspace matrix of 64 × 64 for each slice with no motion, it takes 42 hours 30 minutes
on a single processor) whereas fMRI data generation finishes in minutes with our
simulator. Since POSSUM is generating data by solving Bloch equations and T2* is
generated as output, it is expected for data generation to take hours. But in our
simulator we are using real T2 data and adding 4D activation and artifacts on top of
T2 values. This is the reason of why generation of fMRI data with our simulator lasts
in minutes.
3.2.2 Comparison with SimTB
SimTB is an fMRI simulator which has the capability of the creation and
manipulation of spatial sources, block and event-related design types definition,
inclusion of tissue-specific baselines and simulated head movement. It has a GUI to
design and execute simulations.
SimTB calculates the time course of single axial slice. For this reason, it generates 3D
result whereas our simulator generates 4D whole brain FMRI data. Besides, no
artifact other than motion can be added with SimTB.
3.2.3 Comparison with Chris Rorden’s fMRI Design Software
This software is a tool for designing an fMRI study. Tool does not provide 4D fMRI
output and artifacts cannot be defined with this simulator. It only shows HRF time
course of an experiment by using the settings (like TR, number of volumes, design
type etc.) which are defined by user.
Block and event related BOLD responses can be viewed with the simulator. As a
result, this software can only be used for designing fMRI experiments.

46

3.2.4 Comparison with METU-fMRISim
The major difference between the METU-fMRISim and the method described here
is that; there is a baseline level of intensity throughout the whole brain in METUfMRISim. However this approach is not correct since each voxel in fMRI has its own
baseline intensity value produced from T2* weighted images. The intensity of the
fMRI signal must be the original T2* intensity plus activation related intensity. With
our approach, we are using T2 image modality as underlying baseline value and
adding hemodynamic response to this baseline value to create fMRI signal for each
voxel.
ROI selection by using previously defined brain areas is another major strength of
this study. This mechanism is added to simulator since it is not easy to identify brain
areas by drawing them with user effort. Now, there is capability to select brain
areas (those brain areas are defined in a 3D template label file) as a ROI and BOLD
activation in those selected areas will take place in the output fMRI data only.
HRF function in METU-fMRISim cannot be changed by the user. But in our simulator,
it can be changed by changing the coefficients of the HRF function.
Mixed design paradigm is also added which does not exist in METU-fMRISim.
Default Mode Network rsfMRI data generation is another major functionality which
is added with this method.
Cardiac pulsation artifact which exists in METU-fMRISim is not implemented within
this study. As a future study, physiological noises like cardiac pulsation can be
added to this simulator.

47

48

CHAPTER 4

RESULTS

4.1

Verification of Generated Activity

In order to test the activity results of the simulator, an fMRI experiment design was
setup and corresponding 4D brain volume was generated. Then generated 4D brain
volume was analyzed by 3dfim [25] utility of AFNI [23] (This utility return correlation
of the generated time series in a voxel with the ideal task waveform. Higher
correlation coefficient means that there is more probability for that voxel to have
neuronal activity). Given the ROI for which fMRI signals are generated during the
experiment, thresholding is done to decide ‘active’ voxels. Higher thresholds for the
correlation coefficient –such as 0.5- reveal active voxels. We found Jaccard indexes
[26] between the entire ROI for which simulation is done and those voxels AFNI
returned as ‘active’ after thresholding, to verify that the fMRI activity we created is
detectable.
Jaccard index between the ROI, A, in the simulator and voxels, B, detected by AFNI
is calculated as follows:
(

)

Where A and B are sets, is the intersection operation, is the union operation
and J(A,B) is the Jaccard result. In our case, intersection and union are the number
of intersecting and union voxels between the ROI in the simulator and voxels
detected by AFNI.

4.1.1 Verification for Sample Block Design
In order to generate the block paradigm fMRI time series, the parameters in Table
4-1 were used. From Table 4-1, it can be observed that experiment duration is 300
seconds. Volumes are sampled at a rate of 3 seconds/volume. So there are 100
whole brain volumes at the end of experiment. Activity starts at 20 th seconds and
ends in 280th seconds. The HRF signal increase is 4% and the activation will take
place in amygdala.
Table 4-1 Block Design FMRI Simulation Parameters
49

Duration (seconds)
Sampling Rate (TR)
(milliseconds)
TASK
ROI

300
3000
Activity: [20-40,60-80,100-120,140-160,180200,220-240,260-280], HRF Percent: 4
Amygdala

After the fMRI data was generated, it was loaded into AFNI to see the time course
of the voxels. Figure 4-1 is the screenshot of 9 neighbor active voxels’ time series. It
can be seen from the figure that there are 7 ON and 8 OFF periods which
corresponds to the task identified in Table 4-1. For this reason, we confirm that the
simulator generated these ON-OFF periods correctly.

Figure 4-1 Block Paradigm time course
After visual inspection, generated fMRI data was analyzed by AFNI 3dfim utility. The
result of the analysis and the ROI selected from the simulator can be seen in Figure
4-2. The red colored areas are the active voxels according to fMRI analysis. The
yellow colored areas are the active ROI areas depicted by the user during the
simulation run.

50

Figure 4-2 Block design FMRI analysis result (left) and ROI defined in the simulator
(right).
From the Figure 4-2, it can be easily observed that the ROI and fMRI analysis results
are having higher intersection. Also “Jaccard Index” is used to compare the results.
The Jaccard Index calculated between ROI in the simulator and voxels detected by
AFNI is 1 which means that voxels detected by AFNI is fitting over the voxels defined
in the simulator with 100 percent correctness.
4.1.2 Verification for Sample Event Design
In order to generate the event paradigm fMRI, the values at Table 4-2 were used.
From Table 4-2, it can be observed that experiment duration is 300 seconds.
Volumes are sampled at a rate of 3 seconds/volume. So there are 100 whole brain
volumes at the end of experiment. Activity starts at 30th seconds and ends in 270th
seconds. The HRF signal increase is 2 % and the activation will take place in
amygdala.
Table 4-2 Event Related FMRI Simulation Parameters
Duration (seconds)
300
Sampling Rate (TR)
(milliseconds)
3000
Activity: [30,60,90,120,150,180, 210, 240, 270]
TASK
HRF Percent: 2
ROI
Amygdala
After generating the fMRI data, it was loaded into AFNI to see the time course of
the voxels. Figure 4-3 is the screenshot of 9 neighbor active voxels’ time series. As it
51

can be seen from the figure, there are 9 events which correspond to the task
identified in Table 4-2.

Figure 4-3 Event Paradigm time course
Generated fMRI data was then analyzed by AFNI 3dfim utility. The result of the
analysis and ROI selected from the simulator can be seen in Figure 4-4. The blue
colored areas are the active voxels according to fMRI analysis and the yellow
colored areas are the active ROI areas depicted by the user during the simulation
run.

Figure 4-4 Event related FMRI analysis result (left) and ROI defined in the simulator.
From Figure 4-4, it can be easily observed that the ROI and FMRI analysis result are
having higher intersection. Also “Jaccard Index” is used to compare the results. The
Jaccard Index calculated between ROI in the simulator and voxels detected by AFNI
52

is 1 which means that voxels detected by AFNI is fitting over the voxels defined in
the simulator with 100 percent correctness.

4.2

Verification of Motion Artifact
In order to verify the motion introduced by the simulator, AFNI 3dvolreg [27]
utility was used for both rotation and translation effects. If we can detect the
motion by AFNI similarly, then the simulator has done its job in terms of
motion generation.

4.2.1 Rotation
In order to verify the rotation effect, rotations described in Table 4-3 was
generated with the simulator. In order to test the axial, coronal and sagittal
rotations, simulator was re-run 3 times. In each run, rotations listed in Table
4-3 took place on only one of the planes (axial, coronal or sagittal).
Table 4-3 Rotation data generated with Simulator
Time of rotation (seconds)
Rotation (degree)
10
1
20
-1
30
3
40
-3
50
5
60
-5
70
10
80
-10
90
20
100
-20
Then 3dvolreg utility was used to identify the rotations in each plane. The
rotations that were performed via simulation and the corresponding 3dvolreg
calculated results can be seen in Table 4-4. From the table, it can be seen that
rotation performed by the simulator and AFNI 3dvolreg utility calculated
values are close to each other. Therefore we can conclude that the motion
artifacts generated by the simulator are acceptable.

53

Time of
rotation
(seconds)

10
20
30
40
50
60
70
80
90
100

Table 4-4 Rotation Artifact Results
Axial/ Sagittal/
Axial
Sagittal
Coronal Rotation via
Rotation
Rotation
Simulator (degree)
calculated
calculated
by AFNI
by AFNI
3dvolreg
3dvolreg
(degree)
(degree)
1
0.7401
0.7580
-1
-0.7401
-0.7580
3
2.9152
3.0013
-3
-2.9152
-3.0013
5
4.9822
4.9645
-5
-4.9822
-4.9645
10
10.0036
9.9986
-10
-10.0036
-9.9986
20
20.0232
19.9972
-20
-20.0232
-19.9972

Coronal
Rotation
calculated
by AFNI
3dvolreg
(degree)
0.7453
-0.7453
3.0038
-3.0038
4.9569
-4.9569
9.9849
-9.9849
19.9955
-19.9955

4.2.2 Translation
In order to verify the translation effect, translations described in Table 4-5
was generated with the simulator. In order to test the axial, coronal and
sagittal translations, simulator was re-run 3 times. In each run, translation
listed in Table 4-5 took place on only one of the planes (axial, coronal or
sagittal).
Table 4-5 Translation data generated with Simulator
Time of translation
Translation (mm)
(seconds)
10
4
20
-4
30
-8
40
8
50
12
60
-12
70
-16
80
16
90
20
100
-20
Then 3dvolreg utility was used to identify the translations in each plane. The
translations that were performed via simulation and the corresponding results
estimated by 3dvolreg can be seen in Table 4-6. From the table, it can be seen
that translation performed by the simulator and AFNI 3dvolreg utility
calculated values are so close to each other.
54

Time of
translation
(seconds)

10
20
30
40
50
60
70
80
90
100
4.3

Table 4-6 Translation Artifact Results
Axial/ Sagittal/
Axial
Sagittal
Coronal Translation Translation Translation
via Simulator (mm)
calculated
calculated
by AFNI
by AFNI
3dvolreg
3dvolreg
(mm)
(mm)
4
4.0249
4.0264
-4
-4.0249
-4.0264
-8
-8.0488
-8.0511
8
8.0488
8.0511
12
12.0673
12.0682
-12
-12.0673
-12.0682
-16
-16.0425
-16.0913
16
16.0425
16.0913
20
20.1095
20.0978
-20
-20.1095
-20.0978

Coronal
Translation
calculated
by AFNI
3dvolreg
(mm)
4.0210
-4.0210
-8.0399
8.0399
12.0598
-12.0598
-16.0729
16.0729
20.0747
-20.0747

Verification of Drift Artifact

In order to generate the drift artifacts, the values at Table 4-7 were used. This
verification is done only by visual inspection, not quantitatively.
Duration
Sampling Rate
(TR)
TASK
ROI

Table 4-7 Drift Artifact Parameters
300
3000
Activity: [20-40,60-80,100-120,140-160,180200,220-240,260-280], HRF Percent: 4
Amygdala

3 types of drift artifacts were added to the fMRI data: 1 st order, 2nd order and 3rd
order. After generating the data, it was loaded in AFNI to see the time course of the
voxels. Figure 4-5a, Figure 4-5b and Figure 4-5c are the screenshots of 9 neighbor
active voxels’ time series for 1st order, 2nd order and 3rd order drift artifacts
respectively. From the figures it can be seen that the baseline of signals contain the
desired drift function shapes. The ideal task waveform is drawn in red color to
indicate the signal without a drift.

55

(a)

(b)

(c)
Figure 4-5 1 , 2 and 3 order drift artifacts (a, b, c respectively)
st

4.4

nd

rd

Verification of Habituation

In order to generate the drift artifacts, the values at Table 4-8 were used. This
verification is done only by visual inspection, not quantitatively.

56

Duration
Sampling Rate
(TR)
TASK
ROI

Table 4-8 Habituation Artifact Parameters
300
3000
Activity: [20-40,60-80,100-120,140-160,180200,220-240,260-280], HRF Percent: 4,
Habituation Ratio:0.3
Amygdala

After generating the FMRI data, it was loaded into AFNI to see the time course of
the voxels. Figure 4-6 and Figure 4-7 are the screenshot of 9 neighbor active voxels’
time series for habituation artifacts with no lag and 10 seconds lag. In Figure 4-6 it
can be seen that HRF response is decreasing. This is the required effect. In Figure
4-7, HRF response is decreasing as it is in Figure 4-6 except with a signal shift in the
time. The ideal task waveform is drawn in red color to indicate the signal without
habituation and lag.

Figure 4-6 Habituation artifact – no lag

57

Figure 4-7 Habituation artifact – 10 seconds lag
4.5

Verification of Noise

In order to generate the Gaussian noise artifact, the values at Table 4-9 were used.
This verification is done only by visual inspection, not quantitatively.

Duration
Sampling Rate (TR)
TASK
ROI
SNR

Table 4-9 Motion Artifact Parameters
300
1000
Activity: [20-40,60-80,100-120,140-160,180200,220-240,260-280], HRF Percent: 4
Amygdala
10

After generating the fMRI data, it was loaded into AFNI to see the time course of
the voxels. Figure 4-8a is the screenshot of 9 neighbor active voxels’ time series and
Figure 4-8b is the screenshot of passive ones. From the figures noise added signal
can easily be observed in comparison to the ideal task waveform given in red in
Figure 4-8a. From the figure, noise can be easily observed when ideal and noisy
signal are compared.

58

(a)

(b)

Figure 4-8 Noise added signal ((a) active voxels, (b) passive voxels)
4.6

ICA Analysis on Task Related FMRI Data

Under this section, fMRI data generated by our simulator was analyzed by using
Independent Component Analysis approach. This way, we can verify the added
noise artifacts as independent time series. For this, FSL Melodic [22] utility was
used. Independent components and their time courses are shown on each sub
section.
4.6.1 ICA Analysis on Rigid Body Motion Artifact Signal
ICA Analysis was done on a block designed fMRI data (8 OFF- 7 ON blocks, each 20
seconds) where only one 2 degree axial rigid body rotation exist at about 20 th
seconds. ICA analysis was resulted to have 8 components. Among these
components, 7 components are describing the motion [33] on mostly inactive areas
(especially on the boundary of brain) and 1 component is describing the motion [33]
on active area. From Figure 4-9 it can be seen that, the spatial distribution of
component 1 is mostly at the boundary of the brain. By looking at Figure 4-10a-g, an
abrupt change on the normalized responses exist at about 20th seconds which
describes the motion effect.

59

Figure 4-9 IC map of Component 1

(a)

(b)

(c)

(d)

(e)

60

(f)

(g)
Figure 4-10 Time courses of Components 1-7 (a-g in order)
IC (independent component) map Component 8 is shown in Figure 4-11. By looking
at the figure, active brain areas (amygdala) can easily be observed. Also the time
course of component 8 shown in Figure 4-12 clearly represents the task design (8
OFF and 7 ON blocks). Unfortunately, ICA analysis was unable to get rid of the
abrupt head motion at the 20th second of the experiment. This is unexpected, but it
is the responsibility of the fMRI analysis toolkit to perform that action. This
concludes our verification of the motion artifact of the simulator with ICA.

Figure 4-11 IC Map of Component 8

61

Figure 4-12 Time course of Component 8
4.6.2 ICA Analysis on Drift and Noise Artifact Added fMRI Data
Again, ICA Analysis was done on a block designed FMRI (8 OFF- 7 ON blocks, each 20
seconds) data which scanner drift and noise artifacts added. ICA analysis was done
with FSL MELODIC utility which resulted with 21 independent components. The drift
effect can be observed in Figure 4-13 and Figure 4-14. In Figure 4-14, the drift in
signal can be observed easily describing the scanner drift artifact [33].

Figure 4-13 IC Map of Component 1

Figure 4-14 Time course of Component 1
The second component is describing the activity itself which can be seen in Figure
4-15 and Figure 4-16. In Figure 4-15, the spatial map of active area (amygdala) can
be observed. In Figure 4-16, the time course of component 2 is seen. From the
62

figure the block design can easily be observed. The result is as expected since we
can see 8 OFF and 7 ON blocks in the figure.

Figure 4-15 IC Map of Component 2

Figure 4-16 Time course of Component 2
Components 3-21 describe the Gaussian noise components [33] of ICA analysis
which can be seen in Figure 4-17.

(a)

(b)

(c)

(d)

(e)

(f)

63

(g)

(h)

(i)

(j)

(k)

(a)

(a)

(l)

(m)

(n)

(o)

(p)

(q)

Figure 4-17 Time courses of Components 3-21 (a-q in order)
This concludes our ICA verification of active task fMRI data generation.
4.7

ICA Analysis on DMN Related fMRI Data

DMN Related fMRI data was generated with the simulator and FSL Melodic was
used to analyze the generated fMRI. For the DMN generation, 0.90 is used as the
correlation values for DMN data generation from template.
The analysis resulted with 44 independent components. Among them, the
significant ones which are components 40, 41, 42, 43 and 44 were shown with
respect to their anatomical localization in Figure 4-18a, Figure 4-18b, Figure 4-18c,
Figure 4-18d and Figure 4-18e respectively. From the figures, it can be seen than
each of the 6 ROIs used for DMN generation are picked up by ICA. This verifies the
DMN data generation fairly well.

64

(a) dm
mPFC

(b) righht IPL

(c) lefft IPL

(d) ACC++PCC

(e) vm
mPFC
Figuree 4‐18 Com
mponents 40
0‐44
After indeependent co
omponents are analyze
ed, their co
orrelations w
with each other
o
are
calculated
d as seen in Table 4‐100. From the table it can
n be seen thhat the corrrelations
are in bettween 0.13‐0.65. Mostt of the values in Tab
ble 4‐10 aree greater th
han 0.40
which means that the
ese areas arre the describing Default Mode N
Network. We
e cannot
elation valuee between rIPL and vm
mPFC which is 0.13. Thiis will be
explain the low corre
investigated later in a more detaailed quantiitative study.

65
5

Table 4‐10 Correlation of DMN components 40‐44
Brain Area

Posterior
Dorsomedial
Right Inferior Left Inferior
Ventromedial
Cingulate
Prefrontal
Parietal
Parietal
Prefrontal
Cortex
Cortex
Lobule(rIPL) Lobule(lIPL)
Cortex (vmPFC)
(ACC+PCC)
(dmPFC)

Posterior Cingulate Cortex
(ACC+PCC)

1.00

0.48

0.63

0.62

0.55

Right Inferior Parietal
Lobule(rIPL)

0.48

1.00

0.48

0.48

0.13

Left Inferior Parietal
Lobule(lIPL)

0.63

0.48

1.00

0.65

0.48

Dorsomedial Prefrontal
Cortex (dmPFC)

0.62

0.48

0.65

1.00

0.53

Ventromedial Prefrontal
Cortex (vmPFC)

0.55

0.13

0.48

0.53

1.00

66

CHAPTER 5

DISCUSSION AND CONCLUSION

The motivation behind this thesis is the generation of 4D fMRI data which can be
used as a ground truth for comparing/benchmarking different fMRI analysis
methods. By using this ground truth, development of new fMRI analysis methods
may take place. Such a simulator can also be used for educational purposes. In
order to fulfill these aims, an fMRI simulator has been designed and implemented.
The simulator is capable of generating active task data in block, event-related and
mixed designs, as well as resting state data of the default mode network.
Habituation, scanner drift, noise and motion are the artifacts that can be added to
the fMRI signal so that a realistic signal similar to those produced by an MR scanner
can be generated.
There are various fMRI simulators at the present: Chris Rorden’s fMRI Design
Software [11], SimTB [13], POSSUM [12] and METU- fMRISim [14]. Chris Rorden’s
fMRI Design Software [11] is a tool for only designing an fMRI study, but it does not
provide 4D fMRI output and artifacts cannot be defined with this simulator. SimTB
[13] is an fMRI simulator which has the capability of creation and manipulation of
spatial sources, block and event-related design experiments, inclusion of tissuespecific baselines and simulated head movement. It has a GUI to design and execute
simulations. Unfortunately, SimTb calculates the time course of single axial slice.
Besides, no artifact other than motion can be generated with SimTB. POSSUM
(Physics-Oriented Simulated Scanner for Understanding MRI) is a tool for generating
simulated MRI and fMRI images. POSSUM is developed under FSL (FMRIB's Software
Library) [12]. POSSUM collects several MR parameters (relaxation times T1, T2*,
spin density ρ, and chemical shift value δ), pulse sequence (RF angle, RF frequency
bandwidth, RF center frequency), slice profile as well as a pre-generated 4D
activation file from the user in order to simulate the fMR time series using a
mathematical model (i.e. Bloch equations) rather than utilizing an algorithm. This is
somewhat inconvenient because it requires deep knowledge on MR physics and it
takes more than 40 hours to complete. With respect to artifacts, POSSUM is limited
to use motion and noise artifacts. Finally, METU-fMRISim is an fMRI simulator
capable of simulating block and event-related 4D fMRI data with several artifacts:
motion, scanner drift, habituation and cardiac pulsation. However, it does not use a

67

T2 weighted image as a baseline. It generates the fMRI data for a flat image which is
registered to the T1 weighted anatomic image.
With the strengths and weaknesses of the existing fMRI simulators in mind, we
implemented an fMRI simulator in MATLAB which is easy to use with the GUI,
capable of generating most artifacts in the scanner environment for both task based
and resting state conditions, and able to complete within minutes. This simulator
uses a T2-weighted image as baseline in the fMRI time series and the ICBM atlas as
the high resolution anatomic image, so that the activity profiles can be
complemented with pre-defined ROIs in the ICBM atlas. In our approach, we are
using the T2 image modality as underlying baseline value for the fMRI time series so
that hemodynamic response is added to the T2 intensities to create the fMRI signal.
ROI selection by using previously defined brain structures from the T1 weighted
atlas is another strength of this study. This mechanism is added to the simulator
since it is inconvenient to identify brain areas as ROIs manually traced by the users.
This way, multiple brain activity spots can be generated to facilitate functional
connectivity analyses.
We can briefly state the overall functionality of the fMRI simulator as follows. For
the task related fMRI data generation; the duration of experiment and TR value
(time between consecutive 4D whole brain volumes) are designed to be changed by
the user. For DMN data generation, the duration is designed to have fixed value
which is coming from resting templates whereas TR value is user defined. For the
task related fMRI data generation; 4 types of ROI selection was implemented to
define the active voxels: ROI selection by drawing free form canvas, ROI selection by
selecting point, ROI selection from atlas and whole brain as ROI. Two types of
activation patterns were designed: Event and block related activity patterns.
Definition of the activation pattern within the simulator is implemented by entering
active time points for events and active intervals for blocks to have ease of use.
Mixed design is the combination of event and block activation design types. BOLD
response shape and the amplitude of BOLD response are parametric within the
simulator. For the DMN related fMRI data generation, 6 fixed brain areas are
designed to have activity only (Anterior Cingulate Cortex, Posterior Cingulate
Cortex, Right Inferior Parietal Lobule, Left Inferior Parietal Lobule, Dorsomedial
Prefrontal Cortex, Ventromedial Prefrontal Cortex. These brain areas are selected
because of higher correlations reported in the literature. For these brain areas 15
previously collected fMRI datasets from the real fMRI scans are exploited. New
signal correlations with the template signal and new amplitudes can be explored by
adjusting the GUI parameters.
In terms of artifacts, rigid body rotation and translation were implemented to
simulate sudden motion changes or slow changes within a time interval. The
scanner drift artifact, Gaussian white noise, cognitive habituation and lag are other
artifacts that can be utilized. All these artifacts are generated by manipulating
several parameters, such as polynomial order and SNR.
The quality of the data generated by our toolbox is tested thoroughly using AFNI
and FSL utilities. 4D fMRI data which is defined by a task waveform is viewed by
AFNI and the activity within ROI is observed. AFNI 3dfim utility output is then
68

compared with the ROI specified during simulation through Jaccard index. The
generated activity and the estimated activity in AFNI had maximum overlap with
respect to Jaccard index for types of active tasks (i.e. Block and Event –related).
DMN results are verified with FSL Melodic utility to determine ICA components. The
results showed that the ROIs constructed with simulation to contain DMN activity
had been assigned meaningful signal-related ICA components.
The artifacts are also tested thoroughly by AFNI and ICA. Simulated fMRI motion
artifact was analyzed by AFNI 3dvolreg utility. When the motion is inserted by
simulation and the ones that are estimated by AFNI 3dvolgreg utility were
compared, the difference was negligible. Similarly, ICA was able to pick up an abrupt
motion as a separate component, verifying that a detectable motion is being
generated by our simulator. When a simulated fMRI dataset is fed into ICA, drift and
Gaussian noise artifacts are identified as separate components and the main task
time series is separated out, proving that these artifacts are detectable by
mainstream fMRI data processing utilities.
In the future, our simulator can be enhanced to add some other MRI and fMRI
artifacts such as cardiac pulsation. Also T1, T2 and atlas images can be customized
to make the simulator work with user defined images. Instead of using Cholesky
Decompositon to generate correlated signal with respect to template, the simulated
and correlated DMN signal could be generated by using the power spectrum of the
average DMN.
In this thesis it was our aim to produce a fast and easy to use fMRI simulator to
facilitate benchmarking fMRI analysis tools by generating realistic fMRI data to
serve as ground truth. Our simulator will be available for public use through our
website in the short-term future.

69

70

REFERENCES
1. What is fMRI?. (n.d.) Retrieved
http://fmri.ucsd.edu/Research/whatisfmri.html

January

15,

2015,

from

2.What does fMRI measure?. (n.d) Retrieved January 15, 2015, from
http://www.fmrib.ox.ac.uk/research/introduction-to-fmri/what-is-fmri/what-doesfmri-measure-cont
3. Yassa , Michael A. (2005). Functional MRI User's Guide. Retrieved January 17,
2015,
from
http://darwin.bio.uci.edu/~cestark/members/yassa/assets/
Yassa_fMRI_users_guide.pdf
4. Overview of fMRI Analysis. (n.d.). Retrieved January 15, 2015, from
https://sites.google.com/site/mritutorial/functional-mri-tutorials/tutorial-ioverview-of-fmri-analysis/overview
5. BACKGROUND: GENERAL INFORMATION FMRI Experimental Design (n.d).
Retrieved
January
18,
2015,
from
http://afni.nimh.nih.gov/pub/dist/HOWTO/howto/ht03_stim/html/stim_backgroun
d.html
6. Petersen, S.E., Dubis, J.W. The mixed block/event-related design. NeuroImage
(2011). doi:10.1016/j.neuroimage.2011.09.084
7. Huettel, S., Song, A. W., & McCarthy, G. (2009). Functional Magnetic Resonance
Imaging, Second Edition. Sinauer
8. Clare, S. (1997). Functional MRI : Methods and Applications. Unpublished
doctoral dissertation. University of Nottingham, United Kingdom
9. Turk-Browne NB, Scholl BJ, Chun MM. Babies and brains: Habituation in infant
cognition and functional neuroimaging. Front Hum Neurosci. 2008;2:16.
10. Birn, R., Bandettini, P., Cox, R., & Shaker, R. (1999). Event-related fMRI of tasks
involving brief motion. Human Brain Mapping, 106-114.
11.
fMRI
Simulator.
(n.d)
Retrieved
January
http://www.mccauslandcenter.sc.edu/CRNL/tools/fmrisim

21,

2015,

from

12. I Drobnjak, D Gavaghan, E Süli, J Pitt-Francis and M Jenkinson. Development of
an FMRI Simulator for Modelling Realistic Rigid-Body Motion Artifacts. Magnetic
Resonance in Medicine, 56(2), 364-380, 2006.

71

13. Elena A. Allen, Erik B. Erhardt, Yonghua Wei, Tom Eichele, Vince D. Calhoun
(2011). A simulation toolbox for fMRI data: SimTB. Retrieved January 21, 2015, from
http://mialab.mrn.org/software/simtb/docs/2011_simtb_manual_v18.pdf
14. Türkay, D.K. (2009). SIMULATED FMRI TOOLBOX. Unpublished master’s thesis.
Middle East Technical University, Turkey
15.
ICBM
Template.
(n.d)Retrieved
January
13,
http://www.loni.usc.edu/atlases/Atlas_Detail.php?atlas_id=5

2015,

from

16. Martin Lindquist, Ji Meng Loh, Lauren Atlas, and Tor Wager (2008). Modeling
the Hemodynamic Response Function in fMRI: Efficiency, Bias and Mis-modeling.
NeuroImage, 45, S187-S198.
17. ICBM T2 Atlas (n.d) Retrieved January 13,
http://www.loni.usc.edu/atlases/Atlas_Detail.php?atlas_id=13

2015,

from

18. Tracey,A. Brief Introduction to fMRI physiology. Retrieved January 21, 2015 from
http://www.fmrib.ox.ac.uk/research/introduction-to-fmri/find-out-more/a-briefintroduction-to-fmri-physiology
19. 1000 Functional Connectomes Project. Retrieved May 25, 2015 from
www.nitrc.org/frs/?group_id=296
20.
FSL
Atlases.
Retrieved
http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/Atlases

May

25,2015

from

21. MathWorks Support Team, How can I generate two correlated random vectors
with values drawn from a normal distribution. Retrieved June 12,2015 from
http://www.mathworks.com/matlabcentral/answers/101802-how-can-i-generatetwo-correlated-random-vectors-with-values-drawn-from-a-normal-distribution
22.FSL MELODIC (Multivariate Exploratory Linear Optimized Decomposition into
Independent
Components).
Retrieved
June
1,
2015
from
http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/MELODIC
23.AFNI (Analysis of Functional NeuroImages) Main Page. Retrieved May 1, 2015
from http://afni.nimh.nih.gov/afni/
24.FSL (FMRIB(Oxford Centre for Functional MRI of Brain ) Software Library) Main
Page. Retrieved May 1, 2015 from http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/
25.AFNI
Program:
3dfim,
Retrieved
May
20,
http://afni.nimh.nih.gov/pub/dist/doc/program_help/3dfim.html
26.
Jaccard
index.
Retrieved
https://en.wikipedia.org/wiki/Jaccard_index

72

May

12,

2015
2015

from
from

27.
AFNI
Program:
3dvolreg.
Retrieved
May
20,
2015
http://afni.nimh.nih.gov/pub/dist/doc/program_help/3dvolreg.html

from

28. What is the Default Mode Network. Retrieved 25 June,2015 from
http://neurology.about.com/od/Radiology/fl/What-is-the-Default-ModeNetwork.htm
29. Buckner, R. L.; Andrews-Hanna, J. R.; Schacter, D. L. (2008). The Brain's Default
Network: Anatomy, Function, and Relevance to Disease. Annals of the New York
Academy of Sciences 1124 (1): 1–38.
30. Fair, D. A.; Cohen, A. L.; Dosenbach, N. U. F.; Church, J. A.; Miezin, F. M.; Barch,
D. M.; Raichle, M. E.; Petersen, S. E. et al. (2008). The maturing architecture of the
brain's default network. Proceedings of the National Academy of Sciences 105(10):
4028–32.
31. Raichle, Marcus E.; Snyder, Abraham Z. (2007). A default mode of brain function:
A brief history of an evolving idea. NeuroImage 37 (4): 1083–90
32.Damoiseaux, J. S., Rombouts, S., Barkhof, F., Scheltens, P., Stam, C. J., Smith, S.
M., et al. (2006). Consistent resting-state networks across healthy subjects.
Proceedings of the National Academy of Sciences of the United States of America,
103(37), 13848-13853.
33. Martin J. McKeown, Scott Makeig, Greg G. Brown, Tzyy-Ping Jung, Sandra S.
Kindermann, Anthony J. Bell,Terrence J. Sejnowski (1998). Analysis of fMRI Data by
Blind Separation Into Independent Spatial Components. Human Brain Mapping
6:160–188(1998)
34. Buckner, R. L., Andrews-Hanna, J. R., and Schacter, D. L. (2008). The brain’s
default network: anatomy, function and relevance to disease. Ann. N Y Acad.
Sci. 1124, 1–38. doi: 10.1196/annals.1440.011
35. Mazoyer, B., Zago, L., Mellet, E., Bricogne, S., Etard, O.,et al. (2001). Cortical
networks for working memory and executive functions sustain the conscious resting
state in man. Brain Res. Bull., 54, 287–98.
36. Shulman,G. L., Fiez, J. A., Corbetta,M., Buckner, R. L.,Miezin, F. M., et al. (1997).
Common blood flow changes across visual tasks: II.: decreases in cerebral cortex. J.
Cogn. Neurosci. 9, 648–63.

73

74

APPENDICES
APPENDIX A: USER MANUAL

A.1
Simulator Startup
In order to startup the FMRI simulator, “METU_FMRISimulator_2_0” command
should be entered in the MATLAB command window. After entering the command,
Figure A-1 is displayed.

Figure A-1 FMRI Simulator Main Window screenshot
After that, design type (Event, Block, Mixed and DMN) should be selected. If the
design type is task related (i.e. not DMN) then duration and slice sampling rate (500,
1000, 1500, 2000, 2500 and 3000 ms) should be entered in the window. If design
type is DMN, then duration is entered automatically by the simulator but slice
sampling rate should be entered manually.

75

A.2
Task Related FMRI Window Section
In order to design task related FMRI study, then the fields shown in Figure A-2
should be provided. Below is the order of operation:
1. ROI Selection: In order to define the ROI which identifies active voxels, “ROI
Selection with T1” button should be pressed. In that case, ROI Selection window
will be opened which is described in section A.2.1. After ROI selection has been
made, ROI file name will be shown in the text field next to “ROI Selection with
T1” button.
2. Task (activity) Definition: In order to enter the stimulus active points “+ Insert”
button should be pressed. This adds a new row to the Task List table. For the
event related FMRI design, stimulus values should be entered in the form of
“e1,e2,e3…en" where ex is the time that event has occurred. For the block FMRI
design, the values should be entered in the form of “s 1-e1, s1-e2, s3-e3… sn-en"
where sx-ex is the time interval that defines the active period for the block. For
the mixed design, stimulus can be either in the form of event or block. After
activity definition, HRF percent should be entered too. Tasks stimulus points can
be viewed by pressing “Preview” button. Figure A-3 is an example task stimulus
activity.
3. HRF formula definition: HRF formula definition could be changed by the user.
When the user changes the values, HRF time course can be previewed by
pressing the “Preview” button. Figure A-4 is an example plot of HRF Time
Course. Besides, HRF formula can be viewed by pressing “?” which results the
window shown in Figure A-5 to be displayed. The simulator will use the
parameters defined in this section to generate 4D FMRI data.
4. Task-ROI association: In order to define which task will be associated with
which ROI, user should select related ROIs from Task List or select related tasks
from ROI List by using the checkboxes residing at the end columns. For example
in Figure A-2, Task 1 is associated with ROI 1 (Amygdala) and ROI 2 (Anterior
Nucleus) whereas Task 2 is associated with only ROI2 (Anterior Nucleus). This
means that, the HRF time course of Task1 will be added to ROI 1 and ROI 2 but
Task 2 will be added to ROI 2 only.

76

Figure A-2 Task Related FMRI Section

Figure A-3 Stimulus Active Points

Figure A-4 HRF Time Course

77

Figure A-5 HRF Formula Help Window

A.2.1
ROI Selection Window
In order to open the ROI Selection window, “ROI Selection with T1” button should
be pressed. ROI Selection window can be observed in Figure A-6. 3 types of ROI
selection is available to the user: User defined (either point or polygon) ROIs, ROI
selection from template and whole brain as ROI (The details are provided in
subsequent sections). The user selects/draws related ROIs with these 3 selection
types, fills the ROI Selection filename and presses “Save As” button to save ROIs.
A.2.1.1
User defined ROI selection
In order user to select a user defined (user drawn) ROI, “Slice” selection should be
selected on ROI Selection section. Then ROI type and plane should be selected.
After that, related slice should be selected by using the arrow keys or by selecting a
point on the planes. Then ROI should be drawn on the selected slice of the selected
plane. When ROI selection is made, the information of selected ROI will be shown in
ROI list and ROI will be visible with a color attached.
A.2.1.2
ROI selection from template
In order user to select a ROI from template, “Template” selection should be
selected on ROI Selection section. After that, related ROI should be selected from
the list and “” arrow button be pressed. When ROI selection is made, the
information of selected ROI will be shown in ROI list and ROI will be visible with a
color attached.
A.2.1.3
ROI selection as a whole brain
In order user to select whole brain as a ROI, “Whole Brain” selection should be
selected on ROI Selection section. After that “Add “button should be pressed. When
ROI selection is made, the information of selected ROI will be shown in ROI list and
ROI will be visible with a color attached.

78

Figure A-6 ROI Selection window
A.2.2
Habituation Artifact
In order to add habituation artifact, “Habituation” and “Lag” fields shown inFigure
A-7 should be provided. HRF time course of habituation artifact added signal can be
seen in Figure A-8. Habituation is slope of decreased HRF signal in degrees and lag is
the latency of HRF in seconds.

Figure A-7 Habituation Artifact Definition

79

Figure A-8 HRF time course of habituation artifact added signal

A.3
DMN Related FMRI Window Section
In order to design DMN related FMRI study, then the fields shown in Figure A-9
should be provided. Below is the order of operation:
1. DMN Template Selection: DMN Template should be selected from “DMN
Template” list. “Preview” button can be pressed to view DMN Template. An
example DMN Template is shown in Figure A-10.
2. Correlation Data Entry: Correlation data for each 6 previously defines brain
areas should be entered in the Correlation Data section. Correlation is the
correlation of the resulting signals for that brain area with the signals identified
in selected template. Max amplitude is the maximum amplitude of resulting
signal.

80

Figure A-9 DMN Related FMRI Section

Figure A-10 Sample DMN Template Signal
A.4
Motion Artifact
In order to add motion artifact, then the fields shown in Figure A-11 should be
provided. To add a motion (either rotation or translation) “+ Insert” button should
be pressed. This adds a new row to the Motion List table. Then time of motion
effect should be defined. Time can be in the form of “t” or “t1-t2” where t, t1 and t2
are the time in seconds. If the format is “t” then it means that there is sudden
motion at t second. If the format is “t1-t2” then it means that there is a continuous
motion from t1 to t2. For example in Figure A-11, there is negative 3 degree
rotation at axial plane at 10th second and there are total of 10 degree rotation in the
coronal plane between 20th and 29th seconds which means 1(10/(29-20+1)) degree
coronal rotation per second from 20th to 29th seconds. Translations can be added in
the same way as rotations.

81

Figure A-11 Rigid Body Motion Artifact Definition Section
A.5
Gaussian White Noise
In order to add Gaussian white noise, then “Noise” checkbox should be selected and
SNR value should be entered as shown in Figure A-12. HRF time course of noise
added signal can be seen in Figure A-13.

Figure A-12 Gaussian White Noise Definition Section

Figure A-13 HRF time course of noise added signal

A.6
Scanner Drift Artifact
In order to add scanner drift, then “Scanner Drift” checkbox should be selected and
drift function coefficient and max amplitude of drift should be entered as shown in
Figure A-14. HRF time course of drift added signal can be seen in Figure A-15.
82

Figure A-14 Scanner Drift Artifact Definition Section

Figure A-15 HRF time course of drift added signal
A.7
HRF Time Course Preview
In order to see the HRF time course, “Timecourse Preview” button should be
pressed. This opens HRF Time Course window as shown in Figure A-16. Each row in
this window represents a ROI. For example in this figure, there are two ROIs which
are Amygdala and Anterior Nucleus. On the window, left side represents the BOLD
response without artifacts and artifact added signal is shown on the right. For
example on the second row left side in Figure A-16, there are two stimuli as shown
in blue and cyan. On the right is the linear summation of stimuli and added artifacts
(noise + drift in this example).

83

Figure A-16 HRF time course of drift+noise added signal
A.8
4D FMRI generation
In order to generate 4D FMRI data, FMRI Filename is entered and “4D FMRI”
button is pressed. A popup window is displayed when data generation is completed.
A.9
Viewing the FMRI Results
In order to view 4D FMRI data, “VIEW” button should be pressed. This opens the
FMRI Viewer window as shown in Figure A-17. In this window, 3 planes are shown:
sagittal, axial and coronal. Also each ROI is represented with a color. When user
selects a voxel, the time course of selected voxel is displayed at the bottom of the
window.
For example, two ROIs exist in Figure A-17: amygdala (cyan) and anterior nucleus
(blue). A voxel from amygdala has been selected and the time course of selected
voxel is shown at the bottom.

Figure A-17 FMRI Viewer window

84

APPENDIX B: DMN TEMPLATES

(a) AnnArbor

(b) Baltimore

(c) Bangor

(d) Berlin

(e) Cambridge

(f) Dallas
85

(g) Leipzig

(h) Oxford

(i) Pittsburgh

(j) Atlanta

(k) Beijing

(l) Cleveland

86

(m) Newark

(n) Newyork

(o) Taipei
Figure B-1 DMN Templates

87

